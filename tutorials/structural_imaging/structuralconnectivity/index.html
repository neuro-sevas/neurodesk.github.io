<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.94.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/neurodesk.github.io/favicons/favicon.ico><link rel=apple-touch-icon href=/neurodesk.github.io/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/neurodesk.github.io/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/neurodesk.github.io/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-192x192.png sizes=192x192><title>Structural connectivity dMRI | NeuroDesk</title><meta name=description content="Example workflow for constructing strutural connectivity (Human connectome project: Single subject)
"><meta property="og:title" content="Structural connectivity dMRI"><meta property="og:description" content="Example workflow for constructing strutural connectivity (Human connectome project: Single subject)
"><meta property="og:type" content="article"><meta property="og:url" content="https://neuro-sevas/neurodesk.github.io/tutorials/structural_imaging/structuralconnectivity/"><meta property="article:section" content="tutorials"><meta property="article:modified_time" content="2022-04-11T21:38:59+10:00"><meta property="og:site_name" content="NeuroDesk"><meta itemprop=name content="Structural connectivity dMRI"><meta itemprop=description content="Example workflow for constructing strutural connectivity (Human connectome project: Single subject)
"><meta itemprop=dateModified content="2022-04-11T21:38:59+10:00"><meta itemprop=wordCount content="728"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Structural connectivity dMRI"><meta name=twitter:description content="Example workflow for constructing strutural connectivity (Human connectome project: Single subject)
"><link rel=preload href=/neurodesk.github.io/scss/main.min.8ae326e95d9c6881ebe419ebd82c6634a8ac6728b2415ccd672d345f03b4cb1b.css as=style><link href=/neurodesk.github.io/scss/main.min.8ae326e95d9c6881ebe419ebd82c6634a8ac6728b2415ccd672d345f03b4cb1b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=/neurodesk.github.io/css/prism.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-221108279-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/neurodesk.github.io/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">NeuroDesk</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/docs/how-to-cite-us/><span>Cite</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/docs/faq/><span>FAQ</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/applications/><span>Applications</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/developers/><span>Developers</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/neurodesk.github.io/tutorials/><span class=active>Tutorials</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/NeuroDesk target=_blank><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://twitter.com/neuro_desk target=_blank><span>News</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/neurodesk.github.io/offline-search-index.49958059539d8b508473f889b67a882f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/neurodesk.github.io/offline-search-index.49958059539d8b508473f889b67a882f.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-neurodeskgithubiotutorials-li><a href=/neurodesk.github.io/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-neurodeskgithubiotutorials><span>Tutorials</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-neurodeskgithubiotutorialselectrophysiology-li><a href=/neurodesk.github.io/tutorials/electrophysiology/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-neurodeskgithubiotutorialselectrophysiology><span>Electrophysiology</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialselectrophysiologyfieldtrip-li><a href=/neurodesk.github.io/tutorials/electrophysiology/fieldtrip/ title="Analysing M/EEG Data with FieldTrip" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialselectrophysiologyfieldtrip><span>fieldtrip</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialselectrophysiologyeeg_mne-python-li><a href=/neurodesk.github.io/tutorials/electrophysiology/eeg_mne-python/ title="Analysing EEG Data with MNE" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialselectrophysiologyeeg_mne-python><span>MNE-Python: EEG</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-neurodeskgithubiotutorialsfunctional_imaging-li><a href=/neurodesk.github.io/tutorials/functional_imaging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-neurodeskgithubiotutorialsfunctional_imaging><span>Functional Imaging</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsfunctional_imagingfmriprep_cvl-li><a href=/neurodesk.github.io/tutorials/functional_imaging/fmriprep_cvl/ title="Using fmriprep with neurodesk on an HPC" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsfunctional_imagingfmriprep_cvl><span>fmriprep</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsfunctional_imagingmriqc_cvl-li><a href=/neurodesk.github.io/tutorials/functional_imaging/mriqc_cvl/ title="Using mriqc with neurodesk on HPC" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsfunctional_imagingmriqc_cvl><span>mriqc</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsfunctional_imagingphysio-li><a href=/neurodesk.github.io/tutorials/functional_imaging/physio/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsfunctional_imagingphysio><span>PhysIO</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsfunctional_imagingphysio_batch_workflow-li><a href=/neurodesk.github.io/tutorials/functional_imaging/physio_batch_workflow/ title="A batch scripting example for PhysIO toolbox" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsfunctional_imagingphysio_batch_workflow><span>PhysIO_Batch</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-neurodeskgithubiotutorialsphase_processing-li><a href=/neurodesk.github.io/tutorials/phase_processing/ title="MRI phase Processing" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-neurodeskgithubiotutorialsphase_processing><span>MRI Phase</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsphase_processingqsm-li><a href=/neurodesk.github.io/tutorials/phase_processing/qsm/ title="Quantitative Susceptibility Mapping" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsphase_processingqsm><span>QSM</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsphase_processingswi-li><a href=/neurodesk.github.io/tutorials/phase_processing/swi/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsphase_processingswi><span>SWI</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsphase_processingunwrapping-li><a href=/neurodesk.github.io/tutorials/phase_processing/unwrapping/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsphase_processingunwrapping><span>Unwrapping</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-neurodeskgithubiotutorialsreproducibility-li><a href=/neurodesk.github.io/tutorials/reproducibility/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-neurodeskgithubiotutorialsreproducibility><span>Reproducibility</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsreproducibilitydatalad-run-li><a href=/neurodesk.github.io/tutorials/reproducibility/datalad-run/ title="Reproducible script execution with DataLad" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsreproducibilitydatalad-run><span>datalad run</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-neurodeskgithubiotutorialsspectroscopy-li><a href=/neurodesk.github.io/tutorials/spectroscopy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-neurodeskgithubiotutorialsspectroscopy><span>Spectroscopy</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsspectroscopylcmodel-li><a href=/neurodesk.github.io/tutorials/spectroscopy/lcmodel/ title="Spectroscopy with lcmodel" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsspectroscopylcmodel><span>lcmodel</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-neurodeskgithubiotutorialsstructural_imaging-li><a href=/neurodesk.github.io/tutorials/structural_imaging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-neurodeskgithubiotutorialsstructural_imaging><span>Structural Imaging</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsstructural_imagingfreesurfer-li><a href=/neurodesk.github.io/tutorials/structural_imaging/freesurfer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsstructural_imagingfreesurfer><span>FreeSurfer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-neurodeskgithubiotutorialsstructural_imagingstructuralconnectivity-li><a href=/neurodesk.github.io/tutorials/structural_imaging/structuralconnectivity/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsstructural_imagingstructuralconnectivity><span class=td-sidebar-nav-active-item>Structural connectivity dMRI</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-neurodeskgithubiotutorialsdocumentation-li><a href=/neurodesk.github.io/tutorials/documentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-neurodeskgithubiotutorialsdocumentation><span>Documentation</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-neurodeskgithubiotutorialsdocumentationworkflowtemplate-li><a href=/neurodesk.github.io/tutorials/documentation/workflowtemplate/ title="Template for workflow creation" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-neurodeskgithubiotutorialsdocumentationworkflowtemplate><span>Workflow template</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/NeuroDesk/neurodesk.github.io/edit/hugo-docsy/content/en/tutorials/structural_imaging/structuralconnectivity.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/NeuroDesk/neurodesk.github.io/new/hugo-docsy/content/en/tutorials/structural_imaging/structuralconnectivity.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/NeuroDesk/neurodesk.github.io/issues/new?title=Structural%20connectivity%20dMRI" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/NeuroDesk/neurodesk.github.io/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a id=print href=https://neuro-sevas/neurodesk.github.io/tutorials/structural_imaging/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#references>References:</a></li><li><a href=#data-description>Data Description</a><ul><li><a href=#reference>Reference:</a></li><li><a href=#download-demo-data>Download demo data:</a></li><li><a href=#required-structural-preprocessed-input-files>Required structural preprocessed input files</a></li><li><a href=#required-diffusion-preprocessed-input-files>Required diffusion preprocessed input files</a></li></ul></li><li><a href=#install-neurodesk-on-windows-and-mount-external-storage-on-your-host-computer>Install Neurodesk on windows and mount external storage on your host computer</a></li><li><a href=#navigate-to-the-mounted-storage--more-data--create-a-new-folder-of-your-choice---copy-the-required-input-files-into-a-folder-100307>Navigate to the mounted storage&ndash;>more data&ndash;>Create a new folder of your choice&ndash;> copy the required input files into a folder->100307</a></li><li><a href=#activate-mrtrix3-software-in-the-neurodesk-terminal>Activate mrtrix3 software in the neurodesk terminal</a></li><li><a href=#step-1-further-pre-processing>Step 1: Further pre-processing</a></li><li><a href=#step-2-tractogram-construction>Step 2: Tractogram construction</a></li><li><a href=#step-3-sift2-construction>Step 3: SIFT2 construction</a></li><li><a href=#step-4-connectome-construction>Step 4: Connectome construction</a></li><li><a href=#viewing-the-connectome>Viewing the connectome</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><h1>Structural connectivity dMRI</h1><div class=lead>Example workflow for constructing strutural connectivity (Human connectome project: Single subject)</div><header class=article-meta></header><blockquote><p><em>This tutorial was created by Joan Amos.</em></p><p>Email: <a href=mailto:joan@std.uestc.edu.cn>joan@std.uestc.edu.cn</a>
Github: @Joanone</p></blockquote><h2 id=references>References:</h2><p>The steps used for this tutorial were referenced from:
<a href=https://github.com/civier/HCP-dMRI-connectome>https://github.com/civier/HCP-dMRI-connectome</a>
<a href=https://andysbrainbook.readthedocs.io/en/latest/MRtrix/MRtrix_Course/MRtrix_00_Diffusion_Overview.html>https://andysbrainbook.readthedocs.io/en/latest/MRtrix/MRtrix_Course/MRtrix_00_Diffusion_Overview.html</a>
<a href=https://mrtrix.readthedocs.io/en/latest/quantitative_structural_connectivity/structural_connectome.html>https://mrtrix.readthedocs.io/en/latest/quantitative_structural_connectivity/structural_connectome.html</a></p><h2 id=data-description>Data Description</h2><h3 id=reference>Reference:</h3><p>The single subject data used in this tutorial has been preprocessed and was downloaded from:</p><p><a href=https://db.humanconnectome.org/>https://db.humanconnectome.org/</a></p><p>100307_3T_Structural_preproc.zip
100307_3T_Diffusion_preproc.zip</p><h3 id=download-demo-data>Download demo data:</h3><p><a href="https://1drv.ms/u/s!AjZJgBZ_P9UO8nWvAFwQyKQnrroe?e=6qmRlQ">https://1drv.ms/u/s!AjZJgBZ_P9UO8nWvAFwQyKQnrroe?e=6qmRlQ</a> - Diffusion data
<a href="https://1drv.ms/u/s!AjZJgBZ_P9UO8nblYQyUVsibqggs?e=mkwLpQ">https://1drv.ms/u/s!AjZJgBZ_P9UO8nblYQyUVsibqggs?e=mkwLpQ</a> - Structural data</p><h3 id=required-structural-preprocessed-input-files>Required structural preprocessed input files</h3><p>aparc+aseg.nii.gz
T1w_acpc_dc_restore_brain.nii.gz</p><h3 id=required-diffusion-preprocessed-input-files>Required diffusion preprocessed input files</h3><p>bvals
bvecs
data.nii.gz</p><h2 id=install-neurodesk-on-windows-and-mount-external-storage-on-your-host-computer>Install Neurodesk on windows and mount external storage on your host computer</h2><p>References:
<a href=https://neurodesk.github.io/docs/neurodesktop/getting-started/windows/>https://neurodesk.github.io/docs/neurodesktop/getting-started/windows/</a>
<a href=https://neurodesk.github.io/docs/neurodesktop/storage/>https://neurodesk.github.io/docs/neurodesktop/storage/</a></p><p>N/B: Constructing the structural connectivity using dMRI HCP data is computationally intensive. Thus, ensure you have sufficient disk space (>100GB) and RAM size (16, 32GB)</p><p>Open the powershell terminal and run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run --shm-size=1gb -it --privileged --name neurodesktop -v C:/neurodesktop-storage:/neurodesktop-storage -v D:/moredata:/data -p 8080:8080 -h neurodesktop-20220222 vnmd/neurodesktop:20220222
</span></span></code></pre></div><h2 id=navigate-to-the-mounted-storage--more-data--create-a-new-folder-of-your-choice---copy-the-required-input-files-into-a-folder-100307>Navigate to the mounted storage&ndash;>more data&ndash;>Create a new folder of your choice&ndash;> copy the required input files into a folder->100307</h2><p>N/B: The folder created in this tutorial was tagged &ldquo;Test&rdquo;</p><p>Open a terminal in neurodesk and run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>cd/data/Test/100307
</span></span></code></pre></div><h2 id=activate-mrtrix3-software-in-the-neurodesk-terminal>Activate mrtrix3 software in the neurodesk terminal</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>ml mrtrix3/3.0.3
</span></span></code></pre></div><p>N/B: The advantage neurodesk offers is the version of software can be selected from a range of others, which caters for reproducibility. The mrtrix3 (3.0.3) version was used in this tutorial.</p><h2 id=step-1-further-pre-processing>Step 1: Further pre-processing</h2><p>Extract data.nii.gz to enable memory-mapping. The extracted files are about 4.5GB:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>gunzip -c data.nii.gz &gt; data.nii; 
</span></span><span style=display:flex><span>mrconvert data.nii DWI.mif -fslgrad bvecs bvals -datatype float32 -stride 0,0,0,1 -force -info;
</span></span><span style=display:flex><span>rm -f data.nii
</span></span></code></pre></div><p>Perform mrconvert:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>dwibiascorrect ants DWI.mif DWI_bias_ants.mif -bias bias_ants_field.mif -force -info;
</span></span></code></pre></div><p>Extract the response function. Uses -stride 0,0,0,1:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>dwi2response dhollander DWI_bias_ants.mif response_wm.txt response_gm.txt response_csf.txt -voxels RF_voxels.mif -force; 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>dwiextract DWI_bias_ants.mif - -bzero | mrmath - mean meanb0.mif -axis 3 -force -info
</span></span></code></pre></div><p>Generate mask:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>dwi2mask DWI_bias_ants.mif DWI_mask.mif -force -info;
</span></span></code></pre></div><p>Generate Fibre Orientation Distributions (FODs):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>dwi2fod msmt_csd DWI_bias_ants.mif response_wm.txt wmfod.mif response_gm.txt gm.mif  response_csf.txt csf.mif -mask DWI_mask.mif -force -info;
</span></span></code></pre></div><p>Perform normalization:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>mtnormalise wmfod.mif wmfod_norm.mif gm.mif gm_norm.mif csf.mif csf_norm.mif -mask DWI_mask.mif -check_norm mtnormalise_norm.mif -check_mask mtnormalise_mask.mif -force -info
</span></span></code></pre></div><p>Generate a 5 tissue image:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>5ttgen fsl T1w_acpc_dc_restore_brain.nii.gz 5TT.mif -premasked 
</span></span></code></pre></div><p>Convert the B0 image:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>mrconvert meanb0.mif mean_b0.nii.gz
</span></span></code></pre></div><p>Activate the fsl and afni softwares in the neurodesk terminal:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>ml fsl/6.0.3
</span></span><span style=display:flex><span>ml afni/21.0.0
</span></span></code></pre></div><p>Use &ldquo;fslroi&rdquo; to extract the first volume of the segmented dataset which corresponds to the Grey Matter Segmentation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>fslroi 5TT.nii.gz 5TT_vol0.nii.gz 0 
</span></span></code></pre></div><p>Use &ldquo;flirt&rdquo; command to coregister the two datasets:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>flirt -in  mean_b0.nii.gz -ref  5TT_vol0.nii.gz -interp nearestneighbour -dof 6 -omat diff2struct_fsl.mat
</span></span></code></pre></div><p>Convert the transformation matrix to a format readble by MRtrix:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>transformconvert diff2struct_fsl.mat mean_b0.nii.gz 5TT.nii.gz flirt_import diff2struct_mrtrix.txt
</span></span></code></pre></div><p>Coregister the anatomical image to the diffusion image:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>mrtransform 5TT.mif -linear diff2struct_mrtrix.txt -inverse 5TT_coreg 
</span></span></code></pre></div><p>Create the seed boundary which sepearates the grey from the white matter. The command &ldquo;5tt2gmwmi&rdquo; denotes (5 tissue type(segmentation) to grey matter/white matter interface):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>5tt2gmwmi 5TT_coreg.mif gmwmSeed_coreg.mif
</span></span></code></pre></div><h2 id=step-2-tractogram-construction>Step 2: Tractogram construction</h2><p>The probabilistic tractography which is the default in MRtrix is used in this tutorial. The default method is the iFOD2 algorithm.
The number of streamlines used is 10 million, this was chosen to save computational time:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>tckgen -act 5TT_coreg.mif -backtrack -seed_gmwmi gmwmSeed_coreg.mif -nthreads 8 -minlength 5.0 -maxlength 300 -cutoff 0.06 -select 10000000 wmfod_norm.mif tracks_10M.tck -force
</span></span></code></pre></div><h2 id=step-3-sift2-construction>Step 3: SIFT2 construction</h2><p>The generated streamlines can be refined with tcksift2 to counterbalance the overfitting. This creates a text file containing weights for each voxel in the brain:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>tcksift2 -act 5TT_coreg.mif -out_mu sift_mu.txt -out_coeffs sift_coeffs.txt -nthreads 8 tracks.tck wmfod_norm.mif sift_1M.txt -force
</span></span></code></pre></div><h2 id=step-4-connectome-construction>Step 4: Connectome construction</h2><p>In constructing the connectome, the desikan-killany atlas which includes the cortical and sub-cortical regions (84 regions) was used.</p><p>Copy the FreeSurferColorLUT.txt file from the ml freesurfer 7.2.0 singularity container to the subject&rsquo;s folder</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>cp /opt/freesurfer-7.2.0/FreeSurferColorLUT.txt /data/Test/100307
</span></span></code></pre></div><p>Copy the fs_default.txt file from the ml mrtrix3 3.0.3 singularity container to the subject&rsquo;s folder</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>cp /opt/mrtrix3-3.0.3/share/mrtrix3/labelconvert/fs-default.txt /data/Test/100307
</span></span></code></pre></div><p>The command labelconvert will use the parcellation and segmentation output of FreeSurfer to create a new parcellated file in .mif format:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>labelconvert aparc+aseg.nii.gz FreeSurferColorLUT.txt fs_default.txt nodes.mif -force
</span></span></code></pre></div><p>Perform nodes co-registeration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>mrtransform nodes.mif -linear diff2struct_mrtrix.txt -inverse -datatype uint32 nodes_coreg.mif -force
</span></span></code></pre></div><p>Create a whole-brain connectome which denotes the streamlines between each parcellation pair in the atlas. The &ldquo;symmetric&rdquo; option makes the lower and upper diagonal the same, the &ldquo;scale_invnodevol&rdquo; option scales the connectome by the inverse of the size of the node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>tck2connectome -symmetric -zero_diagonal -scale_invnodevol -tck_weights_in sift_1M.txt tracks.tck nodes_coreg.mif  nodes.csv -out_assignment  assignments_nodes.csv -force
</span></span></code></pre></div><h2 id=viewing-the-connectome>Viewing the connectome</h2><p>The generated nodes.csv file can be viewed outside neurodesk as a matrix in Matlab.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>connectome=importdata(&#39;nodes.csv&#39;);
</span></span><span style=display:flex><span>imagesc(connectome,[0 1])
</span></span></code></pre></div><p><img src=/Structural_connectivity_dMRI/Structural_connectivity.png alt=Structural_connectivity title=Structural_connectivity> &ndash;></p><div class="text-muted mt-5 pt-3 border-top">Last modified
April 11, 2022
: <a href=https://github.com/NeuroDesk/neurodesk.github.io/commit/dfcf47d30db4ff1dc06d33618391970514827f00>Minor formatting changes (dfcf47d3)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/neuro_desk aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/NeuroDesk aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Dicussion Forum (requires github login)" aria-label="Dicussion Forum (requires github login)"><a class=text-white target=_blank rel=noopener href=https://github.com/NeuroDesk/neurodesk.github.io/discussions aria-label="Dicussion Forum (requires github login)"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/neurodesk.github.io/js/tabpane-persist.js></script>
<script src=/neurodesk.github.io/js/main.min.2b242016bd393aa86ff3b4500b2baae3b55d65f622435861b9338518eb4a5f69.js integrity="sha256-KyQgFr05Oqhv87RQCyuq47VdZfYiQ1hhuTOFGOtKX2k=" crossorigin=anonymous></script>
<script src=/neurodesk.github.io/js/prism.js></script></body></html>