<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.94.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>A batch scripting example for PhysIO toolbox | NeuroDesk</title><meta name=description content="Follow this tutorial as an example of how to batch script for the PhysIO toolbox using Neurodesk.
"><meta property="og:title" content="A batch scripting example for PhysIO toolbox"><meta property="og:description" content="Follow this tutorial as an example of how to batch script for the PhysIO toolbox using Neurodesk.
"><meta property="og:type" content="article"><meta property="og:url" content="https://www.neurodesk.org/tutorials/functional_imaging/physio_batch_workflow/"><meta property="article:section" content="tutorials"><meta property="article:modified_time" content="2022-02-23T16:30:18+10:00"><meta property="og:site_name" content="NeuroDesk"><meta itemprop=name content="A batch scripting example for PhysIO toolbox"><meta itemprop=description content="Follow this tutorial as an example of how to batch script for the PhysIO toolbox using Neurodesk.
"><meta itemprop=dateModified content="2022-02-23T16:30:18+10:00"><meta itemprop=wordCount content="1080"><meta itemprop=keywords content="template,documentation,"><meta name=twitter:card content="summary"><meta name=twitter:title content="A batch scripting example for PhysIO toolbox"><meta name=twitter:description content="Follow this tutorial as an example of how to batch script for the PhysIO toolbox using Neurodesk.
"><link rel=preload href=/scss/main.min.73d5be94f5e99c5a61460fa5b435757ce8ab87f13970655d157965b5df2b9419.css as=style><link href=/scss/main.min.73d5be94f5e99c5a61460fa5b435757ce8ab87f13970655d157965b5df2b9419.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=/css/prism.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-221108279-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">NeuroDesk</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/how-to-cite-us/><span>Cite</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/faq/><span>FAQ</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/applications/><span>Applications</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/developers/><span>Developers</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/tutorials/><span class=active>Tutorials</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/NeuroDesk target=_blank><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://twitter.com/neuro_desk target=_blank><span>News</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.4fb57893687b7ec100ae18f66cc556f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.4fb57893687b7ec100ae18f66cc556f6.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><a href=/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-tutorials><span>Tutorials</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialselectrophysiology-li><a href=/tutorials/electrophysiology/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialselectrophysiology><span>Electrophysiology</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialselectrophysiologyfieldtrip-li><a href=/tutorials/electrophysiology/fieldtrip/ title="Analysing M/EEG Data with FieldTrip" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialselectrophysiologyfieldtrip><span>fieldtrip</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialselectrophysiologyeeg_mne-python-li><a href=/tutorials/electrophysiology/eeg_mne-python/ title="Analysing EEG Data with MNE" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialselectrophysiologyeeg_mne-python><span>MNE-Python: EEG</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsfunctional_imaging-li><a href=/tutorials/functional_imaging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsfunctional_imaging><span>Functional Imaging</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsfunctional_imagingfmriprep_cvl-li><a href=/tutorials/functional_imaging/fmriprep_cvl/ title="Using fmriprep with neurodesk on an HPC" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsfunctional_imagingfmriprep_cvl><span>fmriprep</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsfunctional_imagingmriqc_cvl-li><a href=/tutorials/functional_imaging/mriqc_cvl/ title="Using mriqc with neurodesk on HPC" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsfunctional_imagingmriqc_cvl><span>mriqc</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsfunctional_imagingphysio-li><a href=/tutorials/functional_imaging/physio/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsfunctional_imagingphysio><span>PhysIO</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-tutorialsfunctional_imagingphysio_batch_workflow-li><a href=/tutorials/functional_imaging/physio_batch_workflow/ title="A batch scripting example for PhysIO toolbox" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsfunctional_imagingphysio_batch_workflow><span class=td-sidebar-nav-active-item>PhysIO_Batch</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsphase_processing-li><a href=/tutorials/phase_processing/ title="MRI phase Processing" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsphase_processing><span>MRI Phase</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsphase_processingqsm-li><a href=/tutorials/phase_processing/qsm/ title="Quantitative Susceptibility Mapping" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsphase_processingqsm><span>QSM</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsphase_processingswi-li><a href=/tutorials/phase_processing/swi/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsphase_processingswi><span>SWI</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsphase_processingunwrapping-li><a href=/tutorials/phase_processing/unwrapping/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsphase_processingunwrapping><span>Unwrapping</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsreproducibility-li><a href=/tutorials/reproducibility/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsreproducibility><span>Reproducibility</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsreproducibilitydatalad-run-li><a href=/tutorials/reproducibility/datalad-run/ title="Reproducible script execution with DataLad" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsreproducibilitydatalad-run><span>datalad run</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsspectroscopy-li><a href=/tutorials/spectroscopy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsspectroscopy><span>Spectroscopy</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsspectroscopylcmodel-li><a href=/tutorials/spectroscopy/lcmodel/ title="Spectroscopy with lcmodel" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsspectroscopylcmodel><span>lcmodel</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsstructural_imaging-li><a href=/tutorials/structural_imaging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsstructural_imaging><span>Structural Imaging</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsstructural_imagingfreesurfer-li><a href=/tutorials/structural_imaging/freesurfer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsstructural_imagingfreesurfer><span>FreeSurfer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsstructural_imagingstructuralconnectivity-li><a href=/tutorials/structural_imaging/structuralconnectivity/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsstructural_imagingstructuralconnectivity><span>Structural connectivity dMRI</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsdocumentation-li><a href=/tutorials/documentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdocumentation><span>Documentation</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdocumentationworkflowtemplate-li><a href=/tutorials/documentation/workflowtemplate/ title="Template for workflow creation" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdocumentationworkflowtemplate><span>Workflow template</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/NeuroDesk/neurodesk.github.io/tree/hugo-docsy/content/en/tutorials/functional_imaging/physio_batch_workflow.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/NeuroDesk/neurodesk.github.io/edit/hugo-docsy/content/en/tutorials/functional_imaging/physio_batch_workflow.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/NeuroDesk/neurodesk.github.io/new/hugo-docsy/content/en/tutorials/functional_imaging/physio_batch_workflow.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/NeuroDesk/neurodesk.github.io/issues/new?title=A%20batch%20scripting%20example%20for%20PhysIO%20toolbox" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/NeuroDesk/neurodesk.github.io/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a id=print href=https://www.neurodesk.org/tutorials/functional_imaging/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><h1>A batch scripting example for PhysIO toolbox</h1><div class=lead>Follow this tutorial as an example of how to batch script for the PhysIO toolbox using Neurodesk.</div><header class=article-meta></header><blockquote><p><em>This tutorial was created by Kelly G. Garner.</em></p><p>Github: @kel-github</p><p>Twitter: @garner_theory</p></blockquote><p>This tutorial walks through 1 way to batch script the use of the PhysIO toolbox with Neurodesk.
The goal is to use the toolbox to generate physiological regressors to use when modelling fMRI data.
The output format of the regressor files are directly compatible for use with SPM, and can be adapted to fit the specifications of other toolboxes.<p></p><h1 id=getting-started>Getting started</h1><p>This tutorial assumes the following:</p><ol><li>Your data are (largely) in BIDs format</li><li>That you have converted your .zip files containing physiological data to .log files. As I was
using a CMRR multi-band sequence, I used <a href=https://github.com/CMRR-C2P/MB/blob/master/extractCMRRPhysio.m>this function</a></li><li>That your .log files are in the subject derivatives/&mldr;/sub-&mldr;/ses-&mldr;/&lsquo;func&rsquo; folders of aformentioned BIDs structured data</li><li>That you have a file that contains the motion regressors you plan to use in your GLM. I&rsquo;ll talk below a bit about what I did with the output given by fmriprep (e.g. &mldr;_desc-confounds_timeseries.tsv&rsquo;)</li><li>That you can use SPM12 and the PhysIO GUI to initialise your batch code</li></ol><p>NB. You can see the code generated from this tutorial <a href=https://github.com/kel-github/imaging_cert_value_7T_pipeline/tree/master/physiol_regress>here</a> (Coming soon!)<p></p><h1 id=1-generate-an-example-script-for-batching>1. Generate an example script for batching</h1><p>First you will create an example batch script that is specific to one of your participants. To achieve this I downloaded locally the relevant &lsquo;.log&rsquo; files for one participant, as well as the &lsquo;&mldr;desc-confounds_timeseries.tsv&rsquo; output for fmriprep for each run. PhysIO is nice in that it will append the regressors from your physiological data to your movement parameters, so that you have a single file of regressors to add to your design matrix in SPM etc (other toolboxes are available).<p></p><p>To work with PhysIO toolbox, your motion parameters need to be in the .txt format as required by SPM.</p><p>I made some simple functions in python that would extract my desired movement regressors and save them to the space separated .txt file as is required by SPM. They can be found <a href=https://github.com/kel-github/imaging_cert_value_7T_pipeline/tree/master/physiol_regress/get_movement_regressors>here</a>. (Coming soon!)</p><p>Once I had my .log files and .txt motion regressors file, I followed the instructions <a href=https://gitlab.ethz.ch/physio/physio-doc/-/wikis/QUICKSTART>here</a> to get going with the Batch editor, and used <a href=https://www.sciencedirect.com/science/article/pii/S016502701630259X>this paper</a> to aid my understanding of how to complete the fields requested by the Batch editor.</p><p>I wound up with a Batch script for the PhysIO toolbox that looked a little bit like this:</p><p><img src=/PhysIO_Batch/PhysIOBatch1.png alt=PhysIOBatch1 title=PhysIOBatch1> &lt;!&ndash; <img src=/subfolder_name/filename.png alt="filename without extension" title="[filename without extension"> &ndash;></p><h1 id=2-generalise-the-script-for-use-with-any-participant>2. Generalise the script for use with any participant</h1><p>Now that you have an example script that contains the specific details for a single participant, you are ready to generalise this code so that you can run it for any participant you choose. I decided to do this by doing the following:</p><ul><li>First I generate an &lsquo;info&rsquo; structure for each participant. This is a structure saved as a matfile for each participant under &lsquo;derivatives&rsquo;, in the relevant sub-z/ses-y/func/ folder. This structure contains the subject specific details that PhysIO needs to know to run. Thus I wrote a matlab function that saves a structure called info with the following fields:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Matlab data-lang=Matlab><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% -- outputs: a matfile containing a structure called info with the</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% following fields:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- sub_num = subject number: [string] of form &#39;01&#39; &#39;11&#39; or &#39;111&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- sess = session number: [integer] e.g. 2</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- nrun = [integer] number of runs for that participant</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- nscans = number of scans (volumes) in the design matrix for each</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    run [1, nrun]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- cardiac_files = a cell of the cardiac files for that participant</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    (1,n = nrun) - attained by using extractCMRRPhysio()</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- respiration_files = same as above but for the resp files - attained by using extractCMRRPhysio()</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- scan_timing = info file from Siemens - attained by using extractCMRRPhysio()</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    -- movement = a cell of the movement regressor files for that</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%    participant (.txt, formatted for SPM)</span>
</span></span></code></pre></div><p>To directly see the functions that produce this information, you can go to this <a href=https://github.com/kel-github/imaging_cert_value_7T_pipeline/tree/master/physiol_regress>repo here</a> <strong>coming soon!</strong></p><ul><li>Next I amended the batch script to load a given participant&rsquo;s info file and to retrieve this information for the required fields in the batch. The batch script winds up looking like this:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Matlab data-lang=Matlab><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%% written by K. Garner, 2022</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% uses batch info:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%-----------------------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% Job saved on 17-Aug-2021 10:35:05 by cfg_util (rev $Rev: 7345 $)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% spm SPM - SPM12 (7771)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% cfg_basicio BasicIO - Unknown</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%-----------------------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% load participant info, and print into the appropriate batch fields below</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% before running spm jobman</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% assumes data is in BIDS format</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%% load participant info</span>
</span></span><span style=display:flex><span><span style=color:#000>sub</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;01&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>dat_path</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;/file/path/to/top-level/of-your-derivatives-fmriprep/folder&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>task</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;attlearn&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>load</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fullfile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dat_path</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;sub-%s&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sub</span><span style=color:#000;font-weight:700>),</span> <span style=color:#4e9a06>&#39;ses-02&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;func&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#8f5902;font-style:italic>...</span>
</span></span><span style=display:flex><span>              <span style=color:#000>sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;sub-%s_ses-02_task-%s_desc-physioinfo&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sub</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>task</span><span style=color:#000;font-weight:700>)))</span>
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>% set variables</span>
</span></span><span style=display:flex><span><span style=color:#000>nrun</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>info</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nrun</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>nscans</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>info</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nscans</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>cardiac_files</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>info</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac_files</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>respiration_files</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>info</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>respiration_files</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>scan_timing</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>info</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>movement</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>info</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>movement</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%% initialise spm</span>
</span></span><span style=display:flex><span><span style=color:#000>spm_jobman</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;initcfg&#39;</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>% check this for later</span>
</span></span><span style=display:flex><span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;defaults&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;FMRI&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>%% run through runs, print info and run </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>irun</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span><span style=color:#000>nrun</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#000>clear</span> <span style=color:#000>matlabbatch</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>save_dir</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>cellstr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fullfile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dat_path</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;sub-%s&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sub</span><span style=color:#000;font-weight:700>),</span> <span style=color:#4e9a06>&#39;ses-02&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;func&#39;</span><span style=color:#000;font-weight:700>));</span> <span style=color:#8f5902;font-style:italic>% 1</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log_files</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>vendor</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;Siemens_Tics&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log_files</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>cardiac_files</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>irun</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>% 2</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log_files</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>respiration</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>respiration_files</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>irun</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>% 3</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log_files</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>irun</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>% 4</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log_files</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sampling_interval</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[];</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log_files</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>relative_start_acquisition</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log_files</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>align_scan</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;last&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Nslices</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>81</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NslicesPerBeat</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[];</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>TR</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1.51</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Ndummies</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Nscans</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>nscans</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>irun</span><span style=color:#000;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>% 5</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>onset_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>time_slice_to_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[];</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sqpar</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Nprep</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[];</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scan_timing</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nominal</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>struct</span><span style=color:#000;font-weight:700>([]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>modality</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;PPU&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>filter</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>no</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>struct</span><span style=color:#000;font-weight:700>([]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>initial_cpulse_select</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>auto_template</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>min</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0.4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>initial_cpulse_select</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>auto_template</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>file</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;initial_cpulse_kRpeakfile.mat&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>initial_cpulse_select</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>auto_template</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>max_heart_rate_bpm</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>90</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cardiac</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>posthoc_cpulse_select</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>off</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>struct</span><span style=color:#000;font-weight:700>([]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>respiratory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>filter</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>passband</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0.01</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>preproc</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>respiratory</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>despike</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>true</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>output_multiple_regressors</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;mregress.txt&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>output_physio</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;physio&#39;</span><span style=color:#000;font-weight:700>;</span> 
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>orthogonalise</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>censor_unreliable_recording_intervals</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>true</span><span style=color:#000;font-weight:700>;</span> <span style=color:#8f5902;font-style:italic>%false; </span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>retroicor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>yes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>order</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>c</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>retroicor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>yes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>order</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>r</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>retroicor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>yes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>order</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>cr</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>rvt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>no</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>struct</span><span style=color:#000;font-weight:700>([]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>hrv</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>no</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>struct</span><span style=color:#000;font-weight:700>([]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>noise_rois</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>no</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>struct</span><span style=color:#000;font-weight:700>([]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>movement</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>yes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>file_realignment_parameters</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#000>fullfile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dat_path</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;sub-%s&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sub</span><span style=color:#000;font-weight:700>),</span> <span style=color:#4e9a06>&#39;ses-02&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;func&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;sub-%s_ses-02_task-%s_run-%d_desc-motion_timeseries.txt&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sub</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>task</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>irun</span><span style=color:#000;font-weight:700>))};</span> <span style=color:#8f5902;font-style:italic>%8</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>movement</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>yes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>order</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>movement</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>yes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>censoring_method</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;FD&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>movement</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>yes</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>censoring_threshold</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>model</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>other</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>no</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>struct</span><span style=color:#000;font-weight:700>([]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>verbose</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>level</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>verbose</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fig_output_file</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>}.</span><span style=color:#000>spm</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>tools</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>physio</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>verbose</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>use_tabs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>false</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#000>spm_jobman</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;run&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>matlabbatch</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>end</span>
</span></span></code></pre></div><h1 id=3-ready-to-run-on-neurodesk>3. Ready to run on Neurodesk!</h1><p>Now we have a batch script, we&rsquo;re ready to run this on Neurodesk - yay!<p></p><p>First make sure the details at the top of the script are correct. You can see that this script could easily be amended to run multiple subjects.</p><p>On Neurodesk, go to the PhysIO toolbox, but select the command line tool rather than the GUI interface (&lsquo;physio r7771 instead of physioGUI r7771). This will take you to the container for the PhysIO toolbox<p></p><p><img src=/PhysIO_Batch/PhysIOBatch2.png alt=PhysIOBatch2 title=PhysIOBatch2> &lt;!&ndash; <img src=/subfolder_name/filename.png alt="filename without extension" title="[filename without extension"> &ndash;></p><p>Now to run your PhysIO batch script, type the command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>run_spm12.sh /opt/mcr/v99/ batch /your/batch/scipt/named_something.m
</span></span></code></pre></div><p>Et Voila! Physiological regressors are now yours - mua ha ha!</p><div class="text-muted mt-5 pt-3 border-top">Last modified February 23, 2022: <a href=https://github.com/NeuroDesk/neurodesk.github.io/commit/8214cfc19310cba0f7e5fcca7e8ac9e3c14ef243>added physio batching tutorial (8214cfc1)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/neuro_desk aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/NeuroDesk aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Dicussion Forum (requires github login)" aria-label="Dicussion Forum (requires github login)"><a class=text-white target=_blank rel=noopener href=https://github.com/NeuroDesk/neurodesk.github.io/discussions aria-label="Dicussion Forum (requires github login)"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.629995429455cc331313ac82f6d5d306b673a13894792ff3fef399a5cac5b87e.js integrity="sha256-YpmVQpRVzDMTE6yC9tXTBrZzoTiUeS/z/vOZpcrFuH4=" crossorigin=anonymous></script>
<script src=/js/prism.js></script></body></html>