<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.94.0"><link rel=canonical type=text/html href=https://neuro-sevas/neurodesk.github.io/developers/new_tools/><link rel=alternate type=application/rss+xml href=https://neuro-sevas/neurodesk.github.io/developers/new_tools/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/neurodesk.github.io/favicons/favicon.ico><link rel=apple-touch-icon href=/neurodesk.github.io/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/neurodesk.github.io/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/neurodesk.github.io/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/neurodesk.github.io/favicons/android-192x192.png sizes=192x192><title>How to add new tools | NeuroDesk</title><meta name=description content="How to add new tools to neurodesk
"><meta property="og:title" content="How to add new tools"><meta property="og:description" content="How to add new tools to neurodesk
"><meta property="og:type" content="website"><meta property="og:url" content="https://neuro-sevas/neurodesk.github.io/developers/new_tools/"><meta property="og:site_name" content="NeuroDesk"><meta itemprop=name content="How to add new tools"><meta itemprop=description content="How to add new tools to neurodesk
"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to add new tools"><meta name=twitter:description content="How to add new tools to neurodesk
"><link rel=preload href=/neurodesk.github.io/scss/main.min.8ae326e95d9c6881ebe419ebd82c6634a8ac6728b2415ccd672d345f03b4cb1b.css as=style><link href=/neurodesk.github.io/scss/main.min.8ae326e95d9c6881ebe419ebd82c6634a8ac6728b2415ccd672d345f03b4cb1b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=/neurodesk.github.io/css/prism.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-221108279-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/neurodesk.github.io/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">NeuroDesk</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/docs/how-to-cite-us/><span>Cite</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/docs/faq/><span>FAQ</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/applications/><span>Applications</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/neurodesk.github.io/developers/><span class=active>Developers</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/neurodesk.github.io/tutorials/><span>Tutorials</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/NeuroDesk target=_blank><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://twitter.com/neuro_desk target=_blank><span>News</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/neurodesk.github.io/offline-search-index.49958059539d8b508473f889b67a882f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/neurodesk.github.io/developers/new_tools/>Return to the regular view of this page</a>.</p></div><h1 class=title>How to add new tools</h1><div class=lead>How to add new tools to neurodesk</div><ul><li>1: <a href=#pg-c122ef84d9e99678ee0fc712da87cffa>Get Neurodesk code</a></li><li>2: <a href=#pg-bd6045c57eea320a927f9a85200b8697>Using Git</a></li><li>3: <a href=#pg-e24a02244ddbf4a83fcf0095e3003590>Add tools</a></li><li>4: <a href=#pg-d8e9695a04ad28c1d14505b5b444f9cb>Fix commit</a></li><li>5: <a href=#pg-d633e953d580caca810a21667c2cd386>Create a pull request</a></li><li>6: <a href=#pg-be505b3d9e340052f832ece047956369>Troubleshooting</a></li><li>7: <a href=#pg-f706aedba5bc93ee895c966642b91365>Menu entries</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-c122ef84d9e99678ee0fc712da87cffa>1 - Get Neurodesk code</h1><div class=lead>Clone neurocontainer code</div><h1 id=get-neurocontainers-code>Get Neurocontainers code</h1><p>Neurocontainers uses a <strong>forked-repo</strong> and <strong><a href=https://git-scm.com/book/en/v2/Git-Branching-Rebasing>rebase</a>-oriented
workflow</strong>. This means that all contributors create a fork of the <a href=https://github.com/NeuroDesk/neurocontainers/>neurocontainer
repository</a> they want to contribute to and then submit pull
requests to the upstream repository to have their contributions reviewed and
accepted. We also recommend you work on feature branches.</p><h2 id=step-1a-create-your-fork>Step 1a: Create your fork</h2><p>The following steps you&rsquo;ll only need to do the first time you set up a machine
for contributing to Neurocontainers. You&rsquo;ll need to repeat the steps for
any additional NeuroDesk projects (<a href=https://github.com/NeuroDesk/>list</a>) that you work on.</p><p>The first thing you&rsquo;ll want to do to contribute to NeuroDesk is fork (<a href=https://help.github.com/en/articles/fork-a-repo>see
how</a>) the appropriate <a href=https://github.com/NeuroDesk/>NeuroDesk repository</a>.</p><h2 id=step-1b-clone-to-your-machine>Step 1b: Clone to your machine</h2><p>Next, clone your fork to your local machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git clone --config pull.rebase https://github.com/YOUR_USERNAME/neurocontainers.git
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Cloning into &#39;neurocontainers&#39;...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Enumerating objects: 6730, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Counting objects: 100% (504/504), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Compressing objects: 100% (229/229), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Total 6730 (delta 308), reused 423 (delta 269), pack-reused 6226
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Receiving objects: 100% (6730/6730), 1.67 MiB | 196.00 KiB/s, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Resolving deltas: 100% (4222/4222), done.
</span></span></span></code></pre></div><p>(The <code>--config pull.rebase</code> option configures Git so that <code>git pull</code>
will behave like <code>git pull --rebase</code> by default. Using
<code>git pull --rebase</code> to update your changes to resolve merge conflicts
is expected by essentially all of open source projects. You can also set that option after cloning using
<code>git config --add pull.rebase true</code>, or just be careful to always run
<code>git pull --rebase</code>, never <code>git pull</code>).</p><p>Note: If you receive an error while cloning, you may not have <a href=https://help.github.com/en/articles/adding-a-new-ssh-key-to-your-github-account>added your ssh
key to GitHub</a>.</p><h2 id=step-1c-connect-your-fork-to-neurocontainers-upstream>Step 1c: Connect your fork to Neurocontainers upstream</h2><p>Next you&rsquo;ll want to <a href=https://help.github.com/en/articles/configuring-a-remote-for-a-fork>configure an upstream remote
repository</a> for your fork of Neurocontainers. This will allow
you to <a href=https://help.github.com/en/articles/syncing-a-fork>sync changes</a> from the main project back into
your fork.</p><p>First, show the currently configured remote repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git remote -v
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>origin  git@github.com:YOUR_USERNAME/neurocontainers.git (fetch)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>origin  git@github.com:YOUR_USERNAME/neurocontainers.git (push)
</span></span></span></code></pre></div><p>Note: If you&rsquo;ve cloned the repository using Github GUI, you may already
have the upstream remote repository configured. For example, when you clone
<a href=https://github.com/NeuroDesk/neurocontainers/>NeuroDesk/neurocontainers</a> with the GitHub desktop client it configures the remote repository <code>neurocontainer</code> and you see the following output from
<code>git remote -v</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>origin  git@github.com:YOUR_USERNAME/neurocontainer.git (fetch)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>origin  git@github.com:YOUR_USERNAME/neurocontainer.git (push)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>neurocontainers	https://github.com/NeuroDesk/neurocontainers.git (fetch)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>neurocontainers	https://github.com/NeuroDesk/neurocontainers.git (push)
</span></span></span></code></pre></div><p>If your client hasn&rsquo;t automatically configured a remote for NeuroDesk/eurocontainers, you&rsquo;ll need to with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git remote add -f upstream https://github.com/NeuroDesk/neurocontainers.git
</span></span></code></pre></div><p>Finally, confirm that the new remote repository, upstream, has been configured:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git remote -v
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>origin	https://github.com/YOUR_USERNAME/neurocontainers.git (fetch)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>origin	https://github.com/YOUR_USERNAME/neurocontainers.git (push)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>upstream	https://github.com/NeuroDesk/neurocontainers.git (fetch)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>upstream	https://github.com/NeuroDesk/neurocontainers.git (push)
</span></span></span></code></pre></div><h2 id=step-2-set-up-the-neurocontainers-development-environment>Step 2: Set up the Neurocontainers development environment</h2><p>If you haven&rsquo;t already, now is a good time to install the Neurocontainers development environment
(<a href=https://www.neurodesk.org/developers/new_tools/add_tool/>Add tools</a>).</p><h2 id=step-3-configure-continuous-integration-for-your-fork>Step 3: Configure continuous integration for your fork</h2><p>This step is optional, but recommended.</p><ol><li>Go to your neurocontainers fork.</li><li>If Actions tab is missing, go to Settings > Actions. Select Allow all actions. Then Save.</li><li>In the actions tab, select “I understand my workflows, go ahead and enable them”</li></ol><p>Neurocontainers is configured to use <a href=https://docs.github.com/en/actions>GitHub Actions</a>
to test and create builds upon each new commit and pull request.
GitHub Actions is the primary CI that runs frontend and backend
tests across a wide range of Ubuntu distributions.</p><p>GitHub Actions is free for open source projects and it&rsquo;s easy to
configure for your own fork of neurocontainer. After doing so, GitHub Actions
will run tests for new refs you push to GitHub and email you the outcome
(you can also view the results in the web interface).</p><p>Running CI against your fork can help save both your and the
NeuroDesk maintainers time by making it easy to test a change fully before
submitting a pull request. We generally recommend a workflow where as
you make changes, you use a fast edit-refresh cycle running individual
tests locally until your changes work. But then once you&rsquo;ve gotten
the tests you&rsquo;d expect to be relevant to your changes working, push a
branch to run the full test suite in GitHub Actions before
you create a pull request. While you wait for GitHub Actions jobs
to run, you can start working on your next task. When the tests finish,
you can create a pull request that you already know passes the tests.</p><p>GitHub Actions will run all the jobs by default on your forked repository.
You can check the <code>Actions</code> tab of your repository to see the builds.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-bd6045c57eea320a927f9a85200b8697>2 - Using Git</h1><div class=lead>Contribution workflow using Git</div><h1 id=working-copies>Working copies</h1><p>When you work on Neurocontainers code, there are three copies of the Neurocontainers Git
repository that you are generally concerned with:</p><ul><li>The <code>upstream</code> remote. This is the <a href=https://github.com/NeuroDesk/neurocontainers>official Neurocontainers
repository</a> on GitHub. You probably
don&rsquo;t have write access to this repository.</li><li>The <strong>origin</strong> remote: Your personal remote repository on GitHub.
You&rsquo;ll use this to share your code and create <a href=../pull_request>pull requests</a>.</li><li>local copy: This lives on your laptop or your remote dev instance,
and is what you&rsquo;ll use to make changes and create commits.</li></ul><p>When you work on Neurocontainers code, you will end up moving code between
the various working copies.</p><h2 id=workflows>Workflows</h2><p>Sometimes you need to get commits. Here are some scenarios:</p><ul><li>You may fork the official Neurocontainers repository to your GitHub fork.</li><li>You may fetch commits from the official Neurocontainers repository to your local copy.</li><li>You occasionally may fetch commits from your forked copy.</li></ul><p>Sometimes you want to publish commits. Here are some scenarios:</p><ul><li>You push code from your local copy to your GitHub fork. (You usually
want to put the commit on a feature branch.)</li><li>You submit a PR to the official Neurocontainers repo.</li></ul><p>Finally, the NeuroDesk core team will occasionally want your changes!</p><ul><li>The NeuroDesk core team can accept your changes and add them to
the official repo, usually on the <code>master</code> branch.</li></ul><h2 id=relevant-git-commands>Relevant Git commands</h2><p>The following commands are useful for moving commits between
working copies:</p><ul><li><code>git fetch</code>: This grabs code from another repository to your local
copy. (Defaults to fetching from your default remote, <code>origin</code>).</li><li><code>git fetch upstream</code>: This grabs code from the upstream repository to your local copy.</li><li><code>git push</code>: This pushes code from your local repository to one of the remotes.</li><li><code>git remote</code>: This helps you configure short names for remotes.</li><li><code>git pull</code>: This pulls code, but by default creates a merge commit
(which you definitely don&rsquo;t want). However, if you&rsquo;ve followed our
<a href=../cloning>cloning documentation</a>, this will do
<code>git pull --rebase</code> instead, which is the only mode you&rsquo;ll want to
use when working on Neurodesk.</li></ul><h2 id=know-what-branch-youre-working-on>Know what branch you&rsquo;re working on</h2><p>When using Git, it&rsquo;s important to know which branch you currently have checked
out because most Git commands implicitly operate on the current branch. You can
determine the currently checked out branch several ways.</p><p>One way is with <a href=https://git-scm.com/docs/git-status>git status</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git status
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>On branch newapp
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>nothing to commit, working directory clean
</span></span></span></code></pre></div><p>Another is with <a href=https://git-scm.com/docs/git-branch>git branch</a> which will display all local
branches, with a star next to the current branch:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git branch
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* newapp
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  master
</span></span></span></code></pre></div><p>To see even more information about your branches, including remote branches,
use <code>git branch -vva</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git branch -vva
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* civet_2.1.1                             f736814 [origin/civet_2.1.1] set DEPLOY_PATH
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  master                                  a0f0455 [origin/master] Merge pull request #129
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  remotes/origin/cat12_with_neurodocker   763f6de works :)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  remotes/origin/civet_2.1.1              f736814 set DEPLOY_PATH
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  remotes/origin/master                   a0f0455 Merge pull request #129
</span></span></span></code></pre></div><p>You can also configure <a href=https://git-scm.com/book/en/v2/Git-in-Other-Environments-Git-in-Bash>Bash</a> and
<a href=https://git-scm.com/book/en/v2/Git-in-Other-Environments-Git-in-Zsh>Zsh</a> to display the current branch in your prompt.</p><h2 id=keep-your-fork-up-to-date>Keep your fork up to date</h2><p>You&rsquo;ll want to <a href=https://help.github.com/en/articles/syncing-a-fork>keep your fork</a> up-to-date with changes
from Neurocontainers&rsquo;s master repositories.</p><p><strong>Note about <code>git pull</code></strong>: Rather than using <code>git pull</code>, which by default is a shortcut for <code>git fetch && git merge FETCH_HEAD</code> (<a href=https://git-scm.com/docs/git-pull>docs</a>), you
should use <code>git pull --rebase</code>, which is like <code>git fetch</code> and then <code>git rebase</code>.</p><p>First, <a href=https://git-scm.com/docs/git-fetch>fetch</a> changes from Neurocontainers&rsquo;s upstream repository you
configured in the step above:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git fetch upstream
</span></span></code></pre></div><p>Next, check out your <code>master</code> branch and <a href=https://git-scm.com/docs/git-rebase>rebase</a> it on top
of <code>upstream/master</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git checkout master
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Switched to branch &#39;master&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git rebase upstream/master
</span></span></code></pre></div><p>This will rollback any changes you&rsquo;ve made to <code>master</code>, update it from
<code>upstream/master</code>, and then re-apply your changes. Rebasing keeps the commit
history clean and readable.</p><p>When you&rsquo;re ready, <a href=https://help.github.com/en/articles/pushing-to-a-remote>push your changes</a> to your remote fork.
Make sure you&rsquo;re in branch <code>master</code> and then run <code>git push</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git checkout master
</span></span><span style=display:flex><span><span style=color:#8f5902>$</span> git push origin master
</span></span></code></pre></div><p>You can keep any branch up to date using this method. If you&rsquo;re working on a
feature branch (see next section), which we recommend, you would change the
command slightly, using the name of your <code>feature-branch</code> rather than <code>master</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git checkout feature-branch
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Switched to branch &#39;feature-branch&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git rebase upstream/master
</span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git push origin feature-branch
</span></span></code></pre></div><h2 id=work-on-a-feature-branch>Work on a feature branch</h2><p>One way to keep your work organized is to create a branch for each issue or
feature. You can and should create as many branches as you&rsquo;d like.</p><p>First, make sure your <code>master</code> branch is up-to-date with Neurocontainers upstream (<a href=#keep-your-fork-up-to-date>see
how</a>).</p><p>Next, from your <code>master</code> branch, create a new tracking branch, providing a
descriptive name for your feature branch:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git checkout master
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Switched to branch &#39;master&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git checkout -b issue-1755-fail2ban
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Switched to a new branch &#39;issue-1755-fail2ban&#39;
</span></span></span></code></pre></div><p>Alternatively, you can create a new branch explicitly based off
<code>upstream/master</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git checkout -b issue-1755-fail2ban upstream/master
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Switched to a new branch &#39;issue-1755-fail2ban&#39;
</span></span></span></code></pre></div><p>Now you&rsquo;re ready to work on the issue or feature.</p><h2 id=stage-changes>Stage changes</h2><p>Recall that files tracked with Git have three possible states:
committed, modified, and staged.</p><p>To prepare a commit, first add the files with changes that you want
to include in your commit to your staging area. You <em>add</em> both new files and
existing ones. You can also remove files from staging when necessary.</p><h3 id=get-status-of-working-directory>Get status of working directory</h3><p>To see which files in the working directory have changes that have not been
staged, use <code>git status</code>.</p><p>If you have no changes in the working directory, you&rsquo;ll see something like
this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git status
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>On branch issue-123
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>nothing to commit, working directory clean
</span></span></span></code></pre></div><p>If you have unstaged changes, you&rsquo;ll see something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>On branch issue-123
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Untracked files:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git add &lt;file&gt;...&#34; to include in what will be committed)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>        build.sh
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>nothing added to commit but untracked files present (use &#34;git add&#34; to track)
</span></span></span></code></pre></div><h3 id=stage-additions-with-git-add>Stage additions with <code>git add</code></h3><p>To add changes to your staging area, use <code>git add &lt;filename></code>. Because
<code>git add</code> is all about staging the changes you want to commit, you use
it to add <em>new files</em> as well as <em>files with changes</em> to your staging
area.</p><p>Continuing our example from above, after we run <code>git add build.sh</code>, we&rsquo;ll see
the following from <code>git status</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>On branch issue-123
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Changes to be committed:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git reset HEAD &lt;file&gt;...&#34; to unstage)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>        new file:   build.sh
</span></span></span></code></pre></div><p>You can view the changes in files you have staged with <code>git diff --cached</code>. To
view changes to files you haven&rsquo;t yet staged, just use <code>git diff</code>.</p><p>If you want to add all changes in the working directory, use <code>git add -A</code>
(<a href=https://git-scm.com/docs/git-add>documentation</a>).</p><p>You can also stage changes using your Github GUI.</p><p>If you stage a file, you can undo it with <code>git reset HEAD &lt;filename></code>. Here&rsquo;s
an example where we stage a file <code>build.sh</code> and then unstage it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git add build.sh
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>On branch issue-1234
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Changes to be committed:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git reset HEAD &lt;file&gt;...&#34; to unstage)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>        new file:   build.sh
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git reset HEAD build.sh
</span></span><span style=display:flex><span><span style=color:#8f5902>$</span> git status
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>On branch issue-1234
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Untracked files:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git add &lt;file&gt;...&#34; to include in what will be committed)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>        build.sh
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>nothing added to commit but untracked files present (use &#34;git add&#34; to track)
</span></span></span></code></pre></div><h3 id=stage-deletions-with-git-rm>Stage deletions with <code>git rm</code></h3><p>To remove existing files from your repository, use <code>git rm</code>
(<a href=https://git-scm.com/docs/git-rm>documentation</a>). This command can either stage the file for
removal from your repository AND delete it from your working directory or just
stage the file for deletion and leave it in your working directory.</p><p>To stage a file for deletion and <strong>remove</strong> it from your working directory, use
<code>git rm &lt;filename></code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git rm test.txt
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>rm &#39;test.txt&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git status
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>On branch issue-1234
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Changes to be committed:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git reset HEAD &lt;file&gt;...&#34; to unstage)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>        deleted:    test.txt
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> ls test.txt
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>ls: No such file or directory
</span></span></span></code></pre></div><p>To stage a file for deletion and <strong>keep</strong> it in your working directory, use
<code>git rm --cached &lt;filename></code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git rm --cached test2.txt
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>rm &#39;test2.txt&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git status
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>On branch issue-1234
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Changes to be committed:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git reset HEAD &lt;file&gt;...&#34; to unstage)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>        deleted:    test2.txt
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> ls test2.txt
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>test2.txt
</span></span></span></code></pre></div><p>If you stage a file for deletion with the <code>--cached</code> option, and haven&rsquo;t yet
run <code>git commit</code>, you can undo it with <code>git reset HEAD &lt;filename></code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git reset HEAD test2.txt
</span></span></code></pre></div><p>Unfortunately, you can&rsquo;t restore a file deleted with <code>git rm</code> if you didn&rsquo;t use
the <code>--cache</code> option. However, <code>git rm</code> only deletes files it knows about.
Files you have never added to Git won&rsquo;t be deleted.</p><h2 id=commit-changes>Commit changes</h2><p>When you&rsquo;ve staged all your changes, you&rsquo;re ready to commit. You can do this
with <code>git commit -m "My commit message."</code> to include a commit message.</p><p>Here&rsquo;s an example of committing with the <code>-m</code> for a one-line commit message:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git commit -m <span style=color:#4e9a06>&#34;Add a test commit for docs.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>[issue-123 173e17a] Add a test commit for docs.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> 1 file changed, 1 insertion(+)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> create mode 100644 newfile.py
</span></span></span></code></pre></div><p>You can also use <code>git commit</code> without the <code>-m</code> option and your editor to open,
allowing you to easily draft a multi-line commit message.</p><p>How long your commit message should be depends on where you are in your work.
Using short, one-line messages for commits related to in-progress work makes
sense. For a commit that you intend to be final or that encompasses a
significant amount or complex work, you should include a longer message.</p><p>Keep in mind that your commit should contain a &lsquo;minimal coherent idea&rsquo; and have
a quality commit message.</p><p>Here&rsquo;s an example of a longer commit message that will be used for a pull request:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Add CIVET 2.1.1 container.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Edit build.sh and README.md to build container for CIVET 2.1.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Tested on my local Ubuntu development server, but need to test within Neurodesktop.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Fixes #1755.
</span></span></code></pre></div><p>The first line is the summary. The following paragraphs are full prose and
explain why and how the change was made. It explains what testing was done
and asks specifically for further testing. The final paragraph indicates
that this commit addresses and fixes issue #1755.
When you submit your pull request, GitHub will detect and link this reference
to the appropriate issue. Once your commit is merged into <code>upstream/master</code>, GitHub
will automatically close the referenced issue. See <a href=https://help.github.com/en/articles/closing-issues-via-commit-messages>Closing issues via commit
messages</a> for details.</p><p>Note in particular that GitHub&rsquo;s regular expressions for this feature
are sloppy, so phrases like <code>Partially fixes #1234</code> will automatically
close the issue. Phrases like <code>Fixes part of #1234</code> are a good
alternative.</p><p>Make as many commits as you need to address the issue or implement your feature.</p><h2 id=push-your-commits-to-github>Push your commits to GitHub</h2><p>As you&rsquo;re working, it&rsquo;s a good idea to frequently push your changes to GitHub.
This ensures your work is backed up should something happen to your local
machine and allows others to follow your progress. It also allows you to
<a href=../troubleshooting#working-from-multiple-computers>work from multiple computers</a> without losing work.</p><p>Pushing to a feature branch is just like pushing to <code>master</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git push origin &lt;branch-name&gt;
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Counting objects: 6, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Delta compression using up to 4 threads.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Compressing objects: 100% (4/4), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Writing objects: 100% (6/6), 658 bytes | 0 bytes/s, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Total 6 (delta 3), reused 0 (delta 0)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Resolving deltas: 100% (3/3), completed with 1 local objects.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>To git@github.com:christi3k/neurocontainers.git
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> * [new branch]      issue-demo -&gt; issue-demo
</span></span></span></code></pre></div><p>If you want to see what Git will do without actually performing the push, add
the <code>-n</code> (dry-run) option: <code>git push -n origin &lt;branch-name></code>. If everything
looks good, re-run the push command without <code>-n</code>.</p><p>If the feature branch does not already exist on GitHub, it will be created when
you push and you&rsquo;ll see <code>* [new branch]</code> in the command output.</p><h2 id=examine-and-tidy-your-commit-history>Examine and tidy your commit history</h2><p>Examining your commit history prior to submitting your pull request is a good
idea. Will the person reviewing your commit history be able to clearly understand
your progression of work?</p><p>On the command line, you can use the <code>git log</code> command to display an easy to
read list of your commits:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git log --all --graph --oneline --decorate
</span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>* 4f8d75d (HEAD -&gt; 1754-docs-add-git-workflow) docs: Add details about configuring Travis CI.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* bfb2433 (origin/1754-docs-add-git-workflow) docs: Add section for keeping fork up-to-date to Git Guide.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* 4fe10f8 docs: Add sections for creating and configuring fork to Git Guide.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* 985116b docs: Add graphic client recs to Git Guide.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* 3c40103 docs: Add stubs for remaining Git Guide sections.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* fc2c01e docs: Add git guide quickstart.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>| * f0eaee6 (upstream/master) bug: Fix traceback in get_missed_message_token_from_address().
</span></span></span></code></pre></div><p>Alternatively, use your graphical client to view the history for your feature branch.</p><p>If you need to update any of your commits, you can do so with an interactive
<a href=https://help.github.com/en/articles/using-git-rebase>rebase</a>. Common reasons to use an interactive rebase
include:</p><ul><li>squashing several commits into fewer commits</li><li>splitting a single commit into two or more</li><li>rewriting one or more commit messages</li></ul><p>There is ample documentation on how to rebase, so we won&rsquo;t go into details
here. We recommend starting with GitHub&rsquo;s help article on
<a href=https://help.github.com/en/articles/using-git-rebase>rebasing</a> and then consulting Git&rsquo;s documentation for
<a href=https://git-scm.com/docs/git-rebase>git-rebase</a> if you need more details.</p><p>If all you need to do is edit the commit message for your last commit, you can
do that with <code>git commit --amend</code>. See <a href=https://git-scm.com/book/en/v2/Git-Basics-Undoing-Things>Git Basics - Undoing
Things</a> for details on this and other useful commands.</p><h2 id=force-push-changes-to-github-after-youve-altered-your-history>Force-push changes to GitHub after you&rsquo;ve altered your history</h2><p>Any time you alter history for commits you have already pushed to GitHub,
you&rsquo;ll need to prefix the name of your branch with a <code>+</code>. Without this, your
updates will be rejected with a message such as:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git push origin 1754-docs-add-git-workflow
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>To git@github.com:christi3k/neurocontainers.git
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> ! [rejected] 1754-docs-add-git-workflow -&gt; 1754-docs-add-git-workflow (non-fast-forward)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>error: failed to push some refs to &#39;git@github.com:christi3k/neurocontainers.git&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>hint: Updates were rejected because the tip of your current branch is behind
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>hint: its remote counterpart. Integrate the remote changes (e.g.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>hint: &#39;git pull ...&#39;) before pushing again.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.
</span></span></span></code></pre></div><p>Re-running the command with <code>+&lt;branch></code> allows the push to continue by
re-writing the history for the remote repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git push origin +1754-docs-add-git-workflow
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Counting objects: 12, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Delta compression using up to 4 threads.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Compressing objects: 100% (12/12), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Writing objects: 100% (12/12), 3.71 KiB | 0 bytes/s, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Total 12 (delta 8), reused 0 (delta 0)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Resolving deltas: 100% (8/8), completed with 2 local objects.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>To git@github.com:christi3k/neurocontainers.git
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> + 2d49e2d...bfb2433 1754-docs-add-git-workflow -&gt; 1754-docs-add-git-workflow (forced update)
</span></span></span></code></pre></div><p>This is perfectly okay to do on your own feature branches, especially if you&rsquo;re
the only one making changes to the branch. If others are working along with
you, they might run into complications when they retrieve your changes because
anyone who has based their changes off a branch you rebase will have to do a
complicated rebase.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e24a02244ddbf4a83fcf0095e3003590>3 - Add tools</h1><div class=lead>Add a tool to neurodesktop</div><p>The goal of <em>neurodesk</em> is to provide users with a large choice of tools to use in their pipelines.
Use the guide below to add a tool to <em>neurodesktop</em> or <em>neurocontainers</em>.</p><h2 id=guiding-principles>Guiding principles</h2><p>To decide if a tool should be packaged in a singularity container in <em>neurocontainers</em> or be installed in the <em>neurodesktop</em> container we are currently following these guiding principles:</p><ol><li><em>neurodesk</em> is not a package manager. This means we are not distributing tools in containers that can easily be installed via a standard package manager</li><li><em>neurodesk</em> allows users to have multiple versions of tools in parallel via <a href=https://lmod.readthedocs.io/en/latest/>lmod</a>, this means that if different versions of a tool can&rsquo;t be installed in parallel we package the tool inside a container.</li><li><em>neurodesk</em> aims to provide tooling to link tools from different containers (such as workflow managers like nipype or nextflow). This means that if a tool is required to coordinate various container-tools, it should be in the <em>neurodesktop</em> container.</li></ol><p>Examples:</p><table><thead><tr><th></th><th>easy install</th><th>coordinates containers</th><th>small in size</th><th>latest version is ok</th><th>useful to most users</th><th>Conclusion</th></tr></thead><tbody><tr><td>git</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>neurodesktop</td></tr><tr><td>lmod</td><td>no</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>neurodesktop</td></tr><tr><td>nipype</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>neurodesktop</td></tr><tr><td>vscode</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>yes</td><td>neurodesktop</td></tr><tr><td>itksnap</td><td>yes</td><td>no</td><td>yes</td><td>yes</td><td>yes</td><td>container?</td></tr><tr><td>convert3D</td><td>yes</td><td>no</td><td>yes</td><td>no</td><td>no</td><td>container</td></tr><tr><td>fsl</td><td>no</td><td>no</td><td>no</td><td>no</td><td>no</td><td>container</td></tr><tr><td>mrtrix</td><td>no</td><td>no</td><td>no</td><td>no</td><td>no</td><td>container</td></tr><tr><td>freesurfer</td><td>no</td><td>no</td><td>no</td><td>no</td><td>no</td><td>container</td></tr></tbody></table><h2 id=adding-new-recipes>Adding new recipes</h2><p>Refer to <a href=https://github.com/NeuroDesk/neurodocker>neurodocker</a> for more information on neurodocker recipes</p><h2 id=build-container>Build container</h2><h3 id=environment-requirements>Environment Requirements</h3><ul><li>Docker</li><li>Recent Python Version<br>Search for &ldquo;python_requires&rdquo; in <a href=https://github.com/NeuroDesk/neurodocker/blob/master/setup.cfg>https://github.com/NeuroDesk/neurodocker/blob/master/setup.cfg</a> for minimal version of Python required. If you have several versions of Python installed in the environment, typing &lsquo;python&rsquo; in the terminal should launch a version with equal or higher version number</li><li>Python pip3<br>This should be launched by &lsquo;python -m pip&rsquo;</li><li>git</li></ul><h3 id=install-neurodocker>Install Neurodocker</h3><p>Neurodocker is the dependency we use to build containers.</p><ol><li>(optional) Sync upstream repository:<br>If you have the permissions to do so: Press &ldquo;Fetch upstream&rdquo; in <a href=https://github.com/NeuroDesk/neurodocker>https://github.com/NeuroDesk/neurodocker</a> to check if our fork of Neurodocker is already up-to-date. Otherwise, open an issue in <a href=https://github.com/NeuroDesk/neurocontainers/issues>https://github.com/NeuroDesk/neurocontainers/issues</a>, requesting to pull-in latest changes from Neurodocker upstream into our fork of Neurodocker. One of the admins will attend the issue and perform the operation.</li><li>(optional) Add a new neurodocker tool:<br>If relevant to your project, add an option to neurodocker that installs new software (<a href=https://github.com/NeuroDesk/neurodocker>https://github.com/NeuroDesk/neurodocker</a>) and create a pull request to neurodocker&rsquo;s main responsitory (add new tool in a branch!).</li><li>Clone our fork of Neurodocker:<pre class="language-shell command-line" data-prompt=$><code>git clone https://github.com/NeuroDesk/neurodocker/</code></pre></li><li>Install neurodocker:<pre class="language-shell command-line" data-prompt=$><code>cd neurodocker  
python -m pip install .
cd ..</code></pre></li><li>Run:
echo &rsquo;export PATH=${PATH}:${HOME}/.local/bin&rsquo; &#187; ${HOME}/.bashrc</li><li>Close the terminal, and reopen it for the updated PATH to take effect</li></ol><h3 id=clone-the-neurocontainers-repository>Clone the Neurocontainers repository</h3><ul><li><p><em>Option A</em>) Fork neurocontainers and setup github actions:<br>Follow the steps in <a href=https://neuro-sevas/neurodesk.github.io/developers/new_tools/cloning/>Get Neurodesk code</a>.</p></li><li><p><em>Option B</em>) Clone from NeuroDesk:</p><pre class="language-shell command-line" data-prompt=$><code>git clone https://github.com/NeuroDesk/neurocontainers/</code></pre></li></ul><h3 id=create-a-new-app>Create a new app</h3><ol><li><p>Copy the directory template and rename to NEWAPP in <code>neurocontainers/recipes</code> (NEWAPP being the name of the application to be displayed in Neurodesk&rsquo;s menu; notice it shouldn&rsquo;t have any special characters):</p><pre class="language-shell command-line" data-prompt=$><code>cd neurocontainers/recipes
cp -R template NEWAPP</code></pre></li><li><p>Create your Container Files:<br>Modify <code>build.sh</code> in <code>neurocontainers/recipes/NEWAPP</code> to build your application and update <code>README.md</code> (make sure the version is correct in the README!). Notice that the example build script in the template has instructions to build a conatiner for datalad, that may or may not suite your exact needs</p><pre class="language-shell command-line" data-prompt=$ data-output=2-3><code>cd NEWAPP
(edit build.sh as required)
(edit README.md as required)</code></pre><p>Upload your application to object storage first if needed, so you can then download it in <code>build.sh</code> (ask for instructions about this if you don&rsquo;t know the key, and never share it anywhere public!)</p></li><li><p>Run <code>update-builders.sh</code>:
This will auto-create the CI workflow for the application (or manually duplicate the template file and rename all occurances of template to NEWAPP)</p><pre class="language-shell command-line" data-prompt=$><code>cd ../..
sh update-builders.sh</code></pre><div class="alert alert-primary" role=alert>If the CI build runs out of space, add the application to the following txt file to add additional space:
<a href=https://github.com/NeuroDesk/neurocontainers/blob/master/.github/workflows/free-up-space-list.txt>https://github.com/NeuroDesk/neurocontainers/blob/master/.github/workflows/free-up-space-list.txt</a>.
Note: this increases CI run time, only use in cases of out-of-space errors.</div></li><li><p>Build and test the container locally</p><ol><li><p>run the build script with the debug flag:</p><pre class="language-shell command-line" data-prompt=$><code>cd recipes/NEWAPP
chmod +x build.sh
./build.sh -ds</code></pre><p>NOTICE: if the README.md file does not contain the same tool-version string as in the build.sh the build will not start to prevent an incorrect README.md description.</p></li><li><p>test running some commands within the container that should be available in your local docker container repository.</p><p>For example, to open an interactive shell in a container (with the home folder /root binded to /root on host), you may run:</p><pre class="language-shell command-line" data-prompt=$><code>sudo docker run -it -v /root:/root --entrypoint /bin/bash NEWAPP_VERSION:TAG
</code></pre><p>with VERSION being the version of the app, and TAG the version tag of the container (run &lsquo;sudo docker image list&rsquo; to find the tag)</p></li><li><p>if your application requires a Matlab Runtime and you get an error about shared library &ldquo;libmwlaunchermain.so&rdquo; not found, check which version of the runtime was installed by the build script</p></li></ol></li><li><p>Update changes in local git repository</p><pre class="language-shell command-line" data-prompt=$><code>git add .github/workflows/NEWAPP.yml recipes/NEWAPP/test.sh recipes/NEWAPP/build.sh recipes/NEWAPP/README.md
git config user.email "the email that you use for github"
git config user.name "your name"
git commit</code></pre></li></ol><h3 id=push-the-new-app-to-neurocontainers>Push the new app to Neurocontainers</h3><p><strong>Prerequisite</strong></p><p>Generate git personal access token (if you don’t have one already)</p><ol><li>Browse to <a href=https://github.com/>https://github.com/</a></li><li>Log into your account</li><li>Press on your picture in upper right corner &ndash;> Setting &ndash;> Developer Settings &ndash;> Personal Access Token</li><li>Press on “generate personal access token”</li><li>Write something in “Notes” (doesn’t matter what, it’s for your own use)</li><li>Check “repo”</li><li>Check “Workflow”</li><li>Press “Generate Token” at the bottom</li><li>Copy the token displayed to somewhere safe, as you will have to user it later</li></ol><p><strong>Step by step guide</strong></p><ol><li><p>Test the container locally, and if successful push repo to trigger the automatic build on GitHub. When asked for your Github password, please provide the personal access token obtained in the previous stage.</p><pre class="language-shell command-line" data-prompt=$><code>git pull
git push</code></pre></li><li><p>Go to <a href=https://github.com/neurodesk/neurocontainers/actions>https://github.com/neurodesk/neurocontainers/actions</a>. Check that the most recent workflow run in the list terminated successfully (green). Otherwise, click on it, click on “build docker”, and the line that caused the error will be highlighted</p></li><li><p>Find your new package under <a href="https://github.com/orgs/NeuroDesk/packages?repo_name=neurocontainers">https://github.com/orgs/NeuroDesk/packages?repo_name=neurocontainers</a><br>Enter the name of the package in the search box, and verify that the full package name shows up in the format <em>toolName_toolVersion</em></p></li><li><p>Obtain <em>buildDate</em> by clicking on the full package name that came up in the search. The build date will be the newest date shown under <strong>Recent tagged image versions</strong></p></li><li><p>Use <em>toolName</em>, <em>toolVersion</em> and <em>buildDate</em> from the previous two steps to manually download the package by typing the following in a terminal open in Neurodesktop</p><pre class="language-shell command-line" data-prompt=$><code>bash /neurocommand/local/fetch_and_run.sh toolName toolVersion buildDate
   (when you see the "Singularity>" prompt, type exit and ENTER)
 ml toolName/toolVersion</code></pre><p>For example:
If the full package name that comes up in the step 11 is itksnap_3.8.0, and the newest date under <strong>Recent tagged image versions</strong> is 20210322</p><p>The command to use in a terminal open in Neurodesktop is:</p><pre class="language-shell command-line" data-prompt=$><code>bash /neurocommand/local/fetch_and_run.sh itksnap 3.8.0 20210322
  (when you see the "Singularity>" prompt, type exit and ENTER)
 ml toolName/toolVersion</code></pre></li></ol><div class="alert alert-warning" role=alert><h4 class=alert-heading>Depreciation notice</h4><p>For VNM users use:</p><pre class="language-shell command-line" data-prompt=$><code>bash /neurodesk/local/fetch_and_run.sh toolName toolVersion buildDate
  ml toolName/toolVersion</code></pre></div><ol start=6><li><p>Test the new container. Run some commands, to see all is good<br>If the container doesn&rsquo;t work yet, it&rsquo;s sometimes useful to try and troubleshoot it and install missing libraries. This can be achieved by running it in a writable mode with fakeroot enabled:</p><pre class="language-shell command-line" data-prompt=$><code>SINGULARITY_BINDPATH=''; singularity shell --writable --fakeroot /neurodesktop-storage/containers/toolName_toolVersion_buildDate/toolName_toolVersion_buildDate.simg</code></pre></li><li><p>Fork <a href=https://github.com/NeuroDesk/neurocommand/>https://github.com/NeuroDesk/neurocommand/</a> to your Github account</p></li><li><p>Edit an entry for your package in your fork of <code>neurocommand/blob/main/neurodesk/apps.json</code> based on one of the other entries (generating one menu item for opening a terminal inside the containers, and one menu item for the GUI, if relevant). Notice that in the json file, the version field should contain the <em>buildDate</em></p></li><li><p>Include an icon file in your fork of neurocommand/neurodesk/icons</p></li><li><p>Send a pull request from your fork of neurocommand to <a href=https://github.com/NeuroDesk/neurocommand/>https://github.com/NeuroDesk/neurocommand/</a></p></li><li><p>When the pull request is merged by Neurodesk admins, it will trigger an action to build the singularity container, distribute it in all object storage locations and on CVMFS, and it will update the menus in the desktop image on the next daily build.</p></li><li><p>Wait at least 24 hours</p></li><li><p>Download and run the daily build of neurodesktop to check that your app can be launched from the start menu and works properly:</p><pre class="language-shell command-line" data-prompt=$><code>sudo docker pull vnmd/neurodesktop:latest && sudo docker run   --shm-size=1gb -it --privileged --name neurodesktop   -v ~/neurodesktop-storage:/neurodesktop-storage   -e HOST_UID="$(id -u)" -e HOST_GID="$(id -g)"   -p 8080:8080 -h neurodesktop-latest   vnmd/neurodesktop:latest</code></pre></li><li><p>Open an issue in <a href=https://github.com/NeuroDesk/neurocontainers/issues>https://github.com/NeuroDesk/neurocontainers/issues</a> notifying that your app appears in the start menu and tested. The app will be included in the next release of Neurodesktop, and will be mentioned in the public announcement that accompanies the release. If the app is not in the start menu or not working as expected based on your earlier testing, open an issue as well, and report it.</p></li><li><p>If somebody wants to use the application before the next release of Neurodesktop is out, you can instruct them to use the command in step 13 above instead of the deafult commands given in the user install instructions.</p></li><li><p>Consider contributing a tutorial about the new tool: <a href=https://github.com/NeuroDesk/neurodesk.github.io/tree/hugo-docsy/content/en/tutorials>https://github.com/NeuroDesk/neurodesk.github.io/tree/hugo-docsy/content/en/tutorials</a></p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-d8e9695a04ad28c1d14505b5b444f9cb>4 - Fix commit</h1><div class=lead>Fix commit</div><h2 id=fixing-the-last-commit>Fixing the last commit</h2><h3 id=changing-the-last-commit-message>Changing the last commit message</h3><ol><li><code>git commit --amend -m "New message"</code></li></ol><h3 id=changing-the-last-commit>Changing the last commit</h3><ol><li>Make your changes to the files</li><li>Run <code>git add &lt;filename></code> to add one file or <code>git add &lt;filename1> &lt;filename2> ...</code> to add multiple files</li><li><code>git commit --amend</code></li></ol><h2 id=fixing-older-commits>Fixing older commits</h2><h3 id=changing-commit-messages>Changing commit messages</h3><ol><li><code>git rebase -i HEAD~5</code> (if, for example, you are editing some of the last five commits)</li><li>For each commit that you want to change the message, change <code>pick</code> to <code>reword</code>, and save</li><li>Change the commit messages</li></ol><h3 id=deleting-old-commits>Deleting old commits</h3><ol><li><code>git rebase -i HEAD~n</code> where <code>n</code> is the number of commits you are looking at</li><li>For each commit that you want to delete, change <code>pick</code> to <code>drop</code>, and save</li></ol><h2 id=squashing-commits>Squashing commits</h2><p>Sometimes, you want to make one commit out of a bunch of commits. To do this,</p><ol><li><code>git rebase -i HEAD~n</code> where <code>n</code> is the number of commits you are interested in</li><li>Change <code>pick</code> to <code>squash</code> on the lines containing the commits you want to squash and save</li></ol><h2 id=reordering-commits>Reordering commits</h2><ol><li><code>git rebase -i HEAD~n</code> where <code>n</code> is the number of commits you are interested in</li><li>Reorder the lines containing the commits and save</li></ol><h2 id=pushing-commits-after-tidying-them>Pushing commits after tidying them</h2><ol><li><code>git push origin +my-feature-branch</code> (Note the <code>+</code> there and substitute your actual branch name.)</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-d633e953d580caca810a21667c2cd386>5 - Create a pull request</h1><div class=lead>Pull request and make contribution</div><h1 id=create-a-pull-request>Create a pull request</h1><p>When you&rsquo;re ready for feedback, submit a pull request. Pull requests
are a feature specific to GitHub. They provide a simple, web-based way
to submit your work (often called &ldquo;patches&rdquo;) to a project. It&rsquo;s called
a <em>pull request</em> because you&rsquo;re asking the project to <em>pull changes</em>
from your fork.</p><p>If you&rsquo;re unfamiliar with how to create a pull request, you can check
out GitHub&rsquo;s documentation on
<a href=https://help.github.com/en/articles/creating-a-pull-request-from-a-fork>creating a pull request from a fork</a>. You
might also find GitHub&rsquo;s article
<a href=https://help.github.com/en/articles/about-pull-requests>about pull requests</a> helpful. That all said,
the tutorial below will walk you through the process.</p><h2 id=create-a-pull-request-1>Create a pull request</h2><h3 id=step-0-make-sure-youre-on-a-feature-branch-not-master>Step 0: Make sure you&rsquo;re on a feature branch (not <code>master</code>)</h3><p>It is important to <a href=../workflow#work-on-a-feature-branch>work on feature branch</a> when creating a pull
request. Your new pull request will be inextricably linked with your
branch while it is open, so you will need to reserve your branch only
for changes related to your issue, and avoid introducing extraneous
changes for other issues or from upstream.</p><p>If you are working on a branch named <code>master</code>, you need to create and
switch to a feature branch before proceeding.</p><h3 id=step-1-update-your-branch-with-git-rebase>Step 1: Update your branch with git rebase</h3><p>The best way to update your branch is with <code>git fetch</code> and <code>git rebase</code>. Do not
use <code>git pull</code> or <code>git merge</code> as this will create merge commits. See <a href=../workflow#keep-your-fork-up-to-date>keep your
fork up to date</a> for details.</p><p>Here&rsquo;s an example (you would replace <em>issue-123</em> with the name of your feature branch):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git checkout issue-123
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Switched to branch &#39;issue-123&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git fetch upstream
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Counting objects: 69, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Compressing objects: 100% (23/23), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Total 69 (delta 49), reused 39 (delta 39), pack-reused 7
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Unpacking objects: 100% (69/69), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>From https://github.com/NeuroDesk/neurocontainers/
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>   69fa600..43e21f6  master     -&gt; upstream/master
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git rebase upstream/master
</span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>First, rewinding head to replay your work on top of it...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Applying: troubleshooting tip about provisioning
</span></span></span></code></pre></div><h3 id=step-2-push-your-updated-branch-to-your-remote-fork>Step 2: Push your updated branch to your remote fork</h3><p>Once you&rsquo;ve updated your local feature branch, push the changes to GitHub:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git push origin issue-123
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Counting objects: 6, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Delta compression using up to 4 threads.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Compressing objects: 100% (4/4), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Writing objects: 100% (6/6), 658 bytes | 0 bytes/s, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Total 6 (delta 3), reused 0 (delta 0)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Resolving deltas: 100% (3/3), completed with 1 local objects.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>To git@github.com:christi3k/neurocontainers.git
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> + 2d49e2d...bfb2433 issue-123 -&gt; issue-123
</span></span></span></code></pre></div><p>If your push is rejected with error <strong>failed to push some refs</strong> then you need
to prefix the name of your branch with a <code>+</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git push origin +issue-123
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Counting objects: 6, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Delta compression using up to 4 threads.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Compressing objects: 100% (4/4), done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Writing objects: 100% (6/6), 658 bytes | 0 bytes/s, done.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Total 6 (delta 3), reused 0 (delta 0)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>remote: Resolving deltas: 100% (3/3), completed with 1 local objects.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>To git@github.com:christi3k/neurocontainers.git
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> + 2d49e2d...bfb2433 issue-123 -&gt; issue-123 (forced update)
</span></span></span></code></pre></div><p>This is perfectly okay to do on your own feature branches, especially if you&rsquo;re
the only one making changes to the branch. If others are working along with
you, they might run into complications when they retrieve your changes because
anyone who has based their changes off a branch you rebase will have to do a
complicated rebase.</p><h3 id=step-3-open-the-pull-request>Step 3: Open the pull request</h3><p>If you&rsquo;ve never created a pull request or need a refresher, take a look at
GitHub&rsquo;s article <a href=https://help.github.com/en/articles/creating-a-pull-request-from-a-fork>creating a pull request from a
fork</a>.
Note: <strong>Pull request titles are different from commit messages.</strong> Commit
messages can be edited with <code>git commit --amend</code>, <code>git rebase -i</code>, etc., while
the title of a pull request can only be edited via GitHub.</p><h2 id=update-a-pull-request>Update a pull request</h2><p>As you make progress on your feature or bugfix, your pull request, once
submitted, will be updated each time you <a href=../workflow#push-your-commits-to-github>push commits</a> to
your remote branch. This means you can keep your pull request open as long as
you need, rather than closing and opening new ones for the same feature or
bugfix.</p><p>It&rsquo;s a good idea to keep your pull request mergeable with neurocontainer upstream by
frequently fetching, rebasing, and pushing changes. See <a href=../workflow#keep-your-fork-up-to-date>keep your fork up to
date</a> for details. You might also find this excellent
article <a href=https://github.com/edx/edx-platform/wiki/How-to-Rebase-a-Pull-Request>How to Rebase a Pull Request</a> helpful.</p><p>And, as you address review comments others have made, we recommend posting a
follow-up comment in which you: a) ask for any clarifications you need, b)
explain to the reviewer how you solved any problems they mentioned, and c) ask
for another review.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-be505b3d9e340052f832ece047956369>6 - Troubleshooting</h1><div class=lead>Troubleshoot commit issue with Git</div><h2 id=undo-a-merge-commit>Undo a merge commit</h2><p>A merge commit is a special type of commit that has two parent commits. It&rsquo;s
created by Git when you merge one branch into another and the last commit on
your current branch is not a direct ancestor of the branch you are trying to
merge in. This happens quite often in a busy project like NeuroDesk where there are
many contributors because upstream/neurocontainer will have new commits while you&rsquo;re
working on a feature or bugfix. In order for Git to merge your changes and the
changes that have occurred on neurocontainer/upstream since you first started your work,
it must perform a three-way merge and create a merge commit.</p><p>neurocontainer uses a forked-repo, rebase-oriented workflow.</p><p>A merge commit is usually created when you&rsquo;ve run <code>git pull</code> or <code>git merge</code>.
You&rsquo;ll know you&rsquo;re creating a merge commit if you&rsquo;re prompted for a commit
message and the default is something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Merge branch &#39;master&#39; of https://github.com/NeuroDesk/neurocontainer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Please enter a commit message to explain why this merge is necessary,
</span></span><span style=display:flex><span># especially if it merges an updated upstream into a topic branch.
</span></span><span style=display:flex><span>#
</span></span><span style=display:flex><span># Lines starting with &#39;#&#39; will be ignored, and an empty message aborts
</span></span><span style=display:flex><span># the commit.
</span></span></code></pre></div><p>And the first entry for <code>git log</code> will show something like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>commit e5f8211a565a5a5448b93e98ed56415255546f94
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Merge: 13bea0e e0c10ed
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Author: Christie Koehler &lt;ck@christi3k.net&gt;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Date:   Mon Oct 10 13:25:51 2016 -0700
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>    Merge branch &#39;master&#39; of https://github.com/NeuroDesk/neurocontainer
</span></span></span></code></pre></div><p>Some graphical Git clients may also create merge commits.</p><p>To undo a merge commit, first run <code>git reflog</code> to identify the commit you want
to roll back to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git reflog
</span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>e5f8211 HEAD@{0}: pull upstream master: Merge made by the &#39;recursive&#39; strategy.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>13bea0e HEAD@{1}: commit: test commit for docs.
</span></span></span></code></pre></div><p>Reflog output will be long. The most recent Git refs will be listed at the top.
In the example above <code>e5f8211 HEAD@{0}:</code> is the merge commit made automatically
by <code>git pull</code> and <code>13bea0e HEAD@{1}:</code> is the last commit I made before running
<code>git pull</code>, the commit that I want to rollback to.</p><p>Once you&rsquo;d identified the ref you want to revert to, you can do so with <a href=https://git-scm.com/docs/git-reset>git
reset</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git reset --hard 13bea0e
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>HEAD is now at 13bea0e test commit for docs.
</span></span></span></code></pre></div><p>:::{important}
<code>git reset --hard &lt;commit></code> will discard all changes in your
working directory and index since the commit you&rsquo;re resetting to with
<code>&lt;commit></code>. <em>This is the main way you can lose work in Git</em>. If you need
to keep any changes that are in your working directory or that you have
committed, use <code>git reset --merge &lt;commit></code> instead.
:::</p><p>You can also use the relative reflog <code>HEAD@{1}</code> instead of the commit hash,
just keep in mind that this changes as you run Git commands.</p><p>Now when you look at the output of <code>git reflog</code>, you should see that the tip of your branch points to your
last commit <code>13bea0e</code> before the merge:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git reflog
</span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>13bea0e HEAD@{2}: reset: moving to HEAD@{1}
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>e5f8211 HEAD@{3}: pull upstream master: Merge made by the &#39;recursive&#39; strategy.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>13bea0e HEAD@{4}: commit: test commit for docs.
</span></span></span></code></pre></div><p>And the first entry <code>git log</code> shows is this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>commit 13bea0e40197b1670e927a9eb05aaf50df9e8277
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Author: Christie Koehler &lt;ck@christi3k.net&gt;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Date:   Mon Oct 10 13:25:38 2016 -0700
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>    test commit for docs.
</span></span></span></code></pre></div><h2 id=restore-a-lost-commit>Restore a lost commit</h2><p>We&rsquo;ve mentioned you can use <code>git reset --hard</code> to rollback to a previous
commit. What if you run <code>git reset --hard</code> and then realize you actually need
one or more of the commits you just discarded? No problem, you can restore them
with <code>git cherry-pick</code> (<a href=https://git-scm.com/docs/git-cherry-pick>docs</a>).</p><p>For example, let&rsquo;s say you just committed &ldquo;some work&rdquo; and your <code>git log</code> looks
like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>* 67aea58 (HEAD -&gt; master) some work
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* 13bea0e test commit for docs.
</span></span></span></code></pre></div><p>You then mistakenly run <code>git reset --hard 13bea0e</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git reset --hard 13bea0e
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>HEAD is now at 13bea0e test commit for docs.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git log
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>* 13bea0e (HEAD -&gt; master) test commit for docs.
</span></span></span></code></pre></div><p>And then realize you actually needed to keep commit 67aea58. First, use
<code>git reflog</code> to confirm that commit you want to restore and then run
<code>git cherry-pick &lt;commit></code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git reflog
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>13bea0e HEAD@{0}: reset: moving to 13bea0e
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>67aea58 HEAD@{1}: commit: some work
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git cherry-pick 67aea58
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic> [master 67aea58] some work
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> Date: Thu Oct 13 11:51:19 2016 -0700
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> 1 file changed, 1 insertion(+)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic> create mode 100644 test4.txt
</span></span></span></code></pre></div><h2 id=recover-from-a-git-rebase-failure>Recover from a <code>git rebase</code> failure</h2><p>One situation in which <code>git rebase</code> will fail and require you to intervene is
when your change, which Git will try to re-apply on top of new commits from
which ever branch you are rebasing on top of, is to code that has been changed
by those new commits.</p><p>For example, while I&rsquo;m working on a file, another contributor makes a change to
that file, submits a pull request and has their code merged into <code>master</code>.
Usually this is not a problem, but in this case the other contributor made a
change to a part of the file I also want to change. When I try to bring my
branch up to date with <code>git fetch</code> and then <code>git rebase upstream/master</code>, I see
the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>First, rewinding head to replay your work on top of it...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Applying: test change for docs
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Using index info to reconstruct a base tree...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>M    README.md
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Falling back to patching base and 3-way merge...
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Auto-merging README.md
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>CONFLICT (content): Merge conflict in README.md
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>error: Failed to merge in the changes.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Patch failed at 0001 test change for docs
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>The copy of the patch that failed is found in: .git/rebase-apply/patch
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>When you have resolved this problem, run &#34;git rebase --continue&#34;.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>If you prefer to skip this patch, run &#34;git rebase --skip&#34; instead.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>To check out the original branch and stop rebasing, run &#34;git rebase --abort&#34;.
</span></span></span></code></pre></div><p>This message tells me that Git was not able to apply my changes to README.md
after bringing in the new commits from upstream/master.</p><p>Running <code>git status</code> also gives me some information:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>rebase in progress; onto 5ae56e6
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>You are currently rebasing branch &#39;docs-test&#39; on &#39;5ae56e6&#39;.
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (fix conflicts and then run &#34;git rebase --continue&#34;)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git rebase --skip&#34; to skip this patch)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git rebase --abort&#34; to check out the original branch)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>Unmerged paths:
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git reset HEAD &lt;file&gt;...&#34; to unstage)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>  (use &#34;git add &lt;file&gt;...&#34; to mark resolution)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>  both modified:   README.md
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-style:italic>no changes added to commit (use &#34;git add&#34; and/or &#34;git commit -a&#34;)
</span></span></span></code></pre></div><p>To fix, open all the files with conflicts in your editor and decide which edits
should be applied. Git uses standard conflict-resolution (<code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>, <code>=======</code>,
and <code>>>>>>>></code>) markers to indicate where in files there are conflicts.</p><p>Tip: You can see recent changes made to a file by running the following
commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git fetch upstream
</span></span><span style=display:flex><span>git log -p upstream/master -- /path/to/file
</span></span></code></pre></div><p>You can use this to compare the changes that you have made to a file with the
ones in upstream, helping you avoid undoing changes from a previous commit when
you are rebasing.</p><p>Once you&rsquo;ve done that, save the file(s), stage them with <code>git add</code> and then
continue the rebase with <code>git rebase --continue</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git add README.md
</span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git rebase --continue
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Applying: test change for docs
</span></span></span></code></pre></div><p>For help resolving merge conflicts, see <a href=https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging#Basic-Merge-Conflicts>basic merge
conflicts</a>, <a href=https://git-scm.com/book/en/v2/Git-Tools-Advanced-Merging#_advanced_merging>advanced
merging</a>, and/or GitHub&rsquo;s help on <a href=https://help.github.com/en/articles/resolving-a-merge-conflict-using-the-command-line>how to resolve a
merge conflict</a>.</p><h2 id=working-from-multiple-computers>Working from multiple computers</h2><p>Working from multiple computers with neurocontainer and Git is fine, but you&rsquo;ll need to
pay attention and do a bit of work to ensure all of your work is readily
available.</p><p>Recall that most Git operations are local. When you commit your changes with
<code>git commit</code> they are safely stored in your <em>local</em> Git database only. That is,
until you <em>push</em> the commits to GitHub, they are only available on the computer
where you committed them.</p><p>So, before you stop working for the day, or before you switch computers, push
all of your commits to GitHub with <code>git push</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git push origin &lt;branchname&gt;
</span></span></code></pre></div><p>When you first start working on a new computer, you&rsquo;ll <a href=../cloning#step-1b-clone-to-your-machine>clone the neurocontainer
repository</a> and <a href=../cloning#step-1c-connect-your-fork-to-neurocontainers-upstream>connect it to neurocontainer
upstream</a>. A clone retrieves all current commits,
including the ones you pushed to GitHub from your other computer.</p><p>But if you&rsquo;re switching to another computer on which you have already cloned
neurocontainer, you need to update your local Git database with new refs from your
GitHub fork. You do this with <code>git fetch</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git fetch &lt;username&gt;
</span></span></code></pre></div><p>Ideally you should do this before you have made any commits on the same branch
on the second computer. Then you can <code>git merge</code> on whichever branch you need
to update:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8f5902>$</span> git checkout &lt;my-branch&gt;
</span></span><span style=display:flex><span><span style=color:#000;font-style:italic>Switched to branch &#39;&lt;my-branch&gt;&#39;
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902>$</span> git merge origin/master
</span></span></code></pre></div><p><strong>If you have already made commits on the second computer that you need to
keep,</strong> you&rsquo;ll need to use <code>git log FETCH_HEAD</code> to identify that hashes of the
commits you want to keep and then <code>git cherry-pick &lt;commit></code> those commits into
whichever branch you need to update.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f706aedba5bc93ee895c966642b91365>7 - Menu entries</h1><div class=lead>Menu entries in neurodesktop</div><h2 id=menu-entry>Menu entry</h2><p>As we want to propose several versions of the tools, each piece of software should have its own submenu under <code>VNM Neuroimaging</code>.
To do so, you first have to add a submenu to <code>menus/vnm-applications.menu</code> by adding:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- [[Tool Name]] submenu --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Menu&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;Name&gt;</span>[[Tool Name]]<span style=color:#204a87;font-weight:700>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;Directory&gt;</span>vnm-[[tool-name]].directory<span style=color:#204a87;font-weight:700>&lt;/Directory&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;Include&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;And&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;Category&gt;</span>[[Tool-Name]]<span style=color:#204a87;font-weight:700>&lt;/Category&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/And&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/Include&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Menu&gt;</span> <span style=color:#8f5902;font-style:italic>&lt;!-- End [[Tool Name]] --&gt;</span>
</span></span></code></pre></div><p>The following table shows the formatting rules to follow:</p><table><thead><tr><th>Placeholder</th><th>Rule</th><th>Example</th></tr></thead><tbody><tr><td><code>[[Tool name]]</code></td><td>Capitalized, spaces</td><td><code>ITK snap</code></td></tr><tr><td><code>[[tool-name]]</code></td><td>Lower case, no spaces (use <code>-</code> instead)</td><td><code>itk-snap</code> or <code>itksnap</code></td></tr><tr><td><code>[[Tool-name]]</code></td><td>Capitalized, no spaces (use <code>-</code> instead)</td><td><code>ITK-snap</code></td></tr></tbody></table><p>Next, we have to create the submenu itself as we referenced it by <code>vnm-[[tool-name]].directory</code>. To do so, create the file <code>menus/submenus/vnm-[[tool-name]].directory</code> and add the following information inside:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Desktop Entry]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>[[Tool Name]]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Comment</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>[[Tool Name]]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Icon</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/home/neuro/.config/lxpanel/LXDE/icons/[[icon-name]].png</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Directory</span>
</span></span></code></pre></div><p>If a specific icon is available in the <code>menus/icons</code> directory, replace <code>[[icon-name]]</code> by its name. Otherwise, use <code>vnm</code>.</p><h2 id=create-the-application>Create the application</h2><p>Finally, we have to create the actual application by creating the file <code>menus/applications/vnm-[[tool-name]]-[[0.0.0]].desktop</code>. The name of this file must contain the version of the tool (once again to allow multiple versions to live inside the same directory). Add the following description to this file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Desktop Entry]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>[[Tool Name]] [[0.0.0]] [[(Install only)]]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>GenericName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>[[Tool Name]] [[0.0.0]]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Comment</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>The description of what clicking on this application does. # This will be the tooltip of the application.</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Exec</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>The command used to run the application.</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Icon</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/home/neuro/.config/lxpanel/LXDE/icons/[[icon-name]].png</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Application</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Categories</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>[[Tool-name]]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Terminal</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>true # or false</span>
</span></span></code></pre></div><p>The important part here is the value of <code>Exec</code>. If the tool is in the form of a singularity image, you should run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash /usr/share/fetch_and_run.sh <span style=color:#ce5c00;font-weight:700>[[</span>tool-name<span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>[[</span>0.0.0<span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>[[</span>YYYYMMDD<span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>[[</span>cmd<span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>[[</span>args<span style=color:#ce5c00;font-weight:700>]]</span>
</span></span></code></pre></div><p>What <code>fetch_and_run.sh</code> does is check if the image is already installed as a module. If not, it checks whether it can be installed or not (return <code>1</code> if not possible). After that, it installs the image as a module.
If <code>[[cmd]]</code> is specified, once the image is installed, it runs the command by giving the arguments from <code>[[args]]</code>.
Here are two examples for FreeSurfer and FreeView. This first one only installs the image as a module:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash /usr/share/fetch_and_run.sh freesurfer 6.0.1 <span style=color:#0000cf;font-weight:700>20200506</span>
</span></span></code></pre></div><p>And this does the same but runs FreeView afterward:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash /usr/share/fetch_and_run.sh freesurfer 6.0.1 <span style=color:#0000cf;font-weight:700>20200506</span> freeview
</span></span></code></pre></div><p>The resulting <code>.desktop</code> file corresponding to FreeView contains:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Desktop Entry]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>FreeView 6.0.1</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>GenericName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>FreeView 6.0.1</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Comment</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Start FreeView 6.0.1</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Exec</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>bash /usr/share/fetch_and_run.sh freesurfer 6.0.1 20200506 freeview</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Icon</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/home/neuro/.config/lxpanel/LXDE/icons/run.png</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Application</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Categories</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>FreeSurfer</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Terminal</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>true</span>
</span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/neuro_desk aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/NeuroDesk aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title aria-label><a class=text-white target=_blank rel=noopener href aria-label><i></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Dicussion Forum (requires github login)" aria-label="Dicussion Forum (requires github login)"><a class=text-white target=_blank rel=noopener href=https://github.com/NeuroDesk/neurodesk.github.io/discussions aria-label="Dicussion Forum (requires github login)"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/neurodesk.github.io/js/tabpane-persist.js></script>
<script src=/neurodesk.github.io/js/main.min.2b242016bd393aa86ff3b4500b2baae3b55d65f622435861b9338518eb4a5f69.js integrity="sha256-KyQgFr05Oqhv87RQCyuq47VdZfYiQ1hhuTOFGOtKX2k=" crossorigin=anonymous></script>
<script src=/neurodesk.github.io/js/prism.js></script></body></html>